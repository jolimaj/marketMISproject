import{k as se,c as b,o as l,w as u,a as e,b as c,e as _,m as K,d,F as P,r as M,t as o,v as re,n as X,f as g,p as ae,q as oe,g as I,h as Y,u as Z,i as $,j as ee}from"./app-BanCskK_.js";import{f as le,a as ne,b as ie,c as de}from"./helper-ugt-wfEi.js";import{l as F,p as te}from"./pickBy-CADBopQR.js";import{A as ce}from"./AppLayout-C4XkhOEP.js";import{B as me}from"./BaseTable-DqakuR4C.js";import{P as ue}from"./Pagination-CEk2Xf0e.js";import{S as xe}from"./SearchFilter-Ds2KTKLN.js";import{B as fe}from"./Badge-JyrJPy6d.js";import{I as ye}from"./Icons-DEAzJamH.js";import{D as pe}from"./Drawer-IRJWmoN6.js";import{C as ge}from"./ConfirmationModal-BnX2MBGg.js";import{D as he}from"./DangerButton-BtMKvAKj.js";import{S as _e}from"./SecondaryButton-D4pPHRxf.js";import{F as we}from"./FlashMessage-BuMPzACp.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logo-BNihBzbJ.js";import"./Footer-qu4Jt-lS.js";import"./Modal-D_qkctnO.js";const ke={__name:"StallRental",props:{stallsCategories:Object,stallRentals:Object,filters:Object,auth:Object},setup(D,{expose:s}){var k,h,V;s();const j=["Rental No.","Vendor","Business Name","Stall","Duration","Type","Quarterly Payment","Due Date","Penalty","Current Payment","Status",""],t=I(!1),f=I({}),R=I(!1),m=D,y=Y({search:(k=m==null?void 0:m.filters)==null?void 0:k.search,category:(h=m==null?void 0:m.filters)==null?void 0:h.category,status:(V=m==null?void 0:m.filters)==null?void 0:V.status}),w=Z({remarks:""});$(y,F.throttle(()=>{var i;ee.get(((i=m.auth.user)==null?void 0:i.role_id)===1?"/admin/rental-management/stall-leasing":"/department/rental-management/stall-leasing",te(y),{preserveState:!0})},150),{deep:!0});function n(){y.search="",y.category=null,Object.assign(y,F.mapValues(y,()=>null))}function p(i){f.value=i,t.value=!0}const v={headers:j,showDrawer:t,drawerData:f,isRejected:R,props:m,form:y,forms:w,reset:n,getDetails:p,printAttachment:i=>{const x=window.open(i,"_blank");x.focus(),x.print()},status:i=>{let x={color:"blue",status:"Vacant"};switch(i){case 3:x={color:"orange",status:"Expired"};break;case 2:x={color:"red",status:"Rejected"};break;case 1:x={color:"green",status:"Approved"};break;default:x={color:"blue",status:"Pending"}}return x},closeRejection:()=>{R.value=!1,t.value=!0},rejectPermits:()=>{t.value=!1,R.value=!0},approveConfirm:()=>{var i;delete w.remarks,w.put(route("department.applications.stalls.approve",(i=f==null?void 0:f.value)==null?void 0:i.id)),t.value=!1},rejectConfirm:()=>{var i;console.log("ss"),w.put(route("department.applications.stalls.reject",(i=f==null?void 0:f.value)==null?void 0:i.id),{onSuccess:()=>{w.reset(),t.value=!1,f.value={},R.value=!1}})},watch:$,reactive:Y,ref:I,get formatAmount(){return de},get formatDate(){return ie},get formatDateShort(){return ne},get fullName(){return le},get router(){return ee},get useForm(){return Z},get throttle(){return F.throttle},get mapValues(){return F.mapValues},get pickBy(){return te},AppLayout:ce,BaseTable:me,Pagination:ue,SearchFilter:xe,Badge:fe,Icons:ye,Drawer:pe,ConfirmationModal:ge,DangerButton:he,SecondaryButton:_e,FlashMessage:we};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}},De={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},je={class:"flex items-center justify-between mb-6"},Ce=["value"],Be={class:"px-4 py-3 capitalize text-center"},Se={class:"px-4 py-3 capitalize text-center"},Ae={class:"px-4 py-3 capitalize text-center"},Re={class:"px-4 py-3 capitalize text-center"},Ve={class:"px-4 py-3 capitalize text-center"},ze={class:"px-4 py-3 capitalize text-center"},Pe={class:"px-4 py-3 capitalize text-center"},Me={class:"px-4 py-3 capitalize text-center"},Ne={class:"px-4 py-3 capitalize text-center"},Ie={class:"px-4 py-3 capitalize text-center"},Fe={class:"px-4 py-3 capitalize text-center"},Le={key:0,class:"w-px border-t"},be={key:0},qe={class:"mt-6 flex justify-center"},Ee={key:0},Oe={class:"h-full overflow-y-auto p-6 space-y-6"},Te={class:"p-4 border rounded-xl bg-gray-50 flex justify-between items-start"},Ue={class:"flex items-start space-x-3"},He={class:"font-semibold text-primary text-base leading-tight"},Qe={class:"flex items-center text-xs text-gray-500 space-x-2 mt-1"},We={key:0,class:"flex space-x-2"},Ge={class:"p-4 border rounded-xl space-y-2"},Je={class:"space-y-3 text-sm"},Ke={class:"flex items-center space-x-3"},Xe={class:"text-gray-600"},Ye={class:"flex items-center space-x-3"},Ze={class:"text-gray-600"},$e={class:"flex items-center space-x-3"},et={class:"text-gray-600"},tt={class:"flex items-center space-x-3"},st={class:"text-gray-600"},rt={class:"flex items-center space-x-3"},at={class:"text-gray-600"},ot={class:"p-4 border rounded-xl space-y-3"},lt={class:"space-y-3 text-sm"},nt={class:"flex items-center space-x-3"},it={class:"text-gray-600"},dt={class:"flex items-center space-x-3"},ct={class:"text-gray-600"},mt={class:"p-4 border rounded-xl space-y-3"},ut={class:"space-y-3 text-sm"},xt={class:"flex items-center space-x-2"},ft={class:"text-gray-600"},yt={class:"flex items-center gap-3"},pt=["href"],gt=["onClick"],ht={class:"p-4 border rounded-xl space-y-3"},_t={class:"space-y-3 text-sm"},wt={class:"text-secondary"},vt={class:"text-gray-600"},kt={class:"flex justify-between px-4 py-2"},Dt={class:"text-gray-600"},jt={key:0,class:"p-4 border rounded-xl space-y-3"},Ct={class:"space-y-3 text-sm"},Bt={class:"text-secondary"},St={class:"text-gray-600"},At={class:"space-y-4 p-4"},Rt={class:"flex justify-end space-x-3 p-4"};function Vt(D,s,j,t,f,R){const m=se("InputError");return l(),b(t.AppLayout,{title:"Stalls"},{header:u(()=>[...s[4]||(s[4]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Stalls ",-1)])]),default:u(()=>{var y,w;return[s[34]||(s[34]=e("h1",{class:"mb-8 text-3xl font-bold text-primary"},"Stall Leasing",-1)),e("div",De,[D.$page.props.flash.success?(l(),b(t.FlashMessage,{key:0,message:D.$page.props.flash.success,type:"success"},null,8,["message"])):_("",!0),D.$page.props.flash.error?(l(),b(t.FlashMessage,{key:1,message:D.$page.props.flash.error,type:"error"},null,8,["message"])):_("",!0),e("div",je,[c(t.SearchFilter,{modelValue:t.form.search,"onUpdate:modelValue":s[1]||(s[1]=n=>t.form.search=n),class:"mr-4 w-full max-w-md",onReset:t.reset},{default:u(()=>[s[6]||(s[6]=e("label",{class:"block text-gray-700"},"Stall Category:",-1)),K(e("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>t.form.status=n),class:"form-select mt-1 w-full"},[s[5]||(s[5]=e("option",{value:null},"All",-1)),(l(!0),d(P,null,M(j.stallsCategories,n=>(l(),d("option",{key:n.id,value:n.id},o(n.name),9,Ce))),128))],512),[[re,t.form.status]])]),_:1},8,["modelValue"])]),c(t.BaseTable,{headers:t.headers,data:(y=j.stallRentals)==null?void 0:y.data,class:X("center")},{row:u(({data:n})=>{var p;return[(l(!0),d(P,null,M(n,(r,N)=>{var C,B,S,A,v,k;return l(),d("tr",{key:j.stallRentals.id,class:"hover:bg-gray-50"},[e("td",Be,o((C=r==null?void 0:r.permits)!=null&&C.permit_number?`${(B=r==null?void 0:r.permits)==null?void 0:B.permit_number}`:"-"),1),e("td",Se,o(`${t.fullName(r==null?void 0:r.vendor)}`),1),e("td",Ae,o(r.name),1),e("td",Re,o((S=r==null?void 0:r.stalls)==null?void 0:S.name),1),e("td",Ve,o(r!=null&&r.start_date&&(r!=null&&r.end_date)?`${t.formatDate(r.start_date)} - ${t.formatDate(r.end_date)}`:"-"),1),e("td",ze,[c(t.Badge,{color:((A=r==null?void 0:r.permits)==null?void 0:A.type)==="new"?"green":"blue"},{default:u(()=>{var h;return[g(o((h=r==null?void 0:r.permits)==null?void 0:h.type),1)]}),_:2},1032,["color"])]),e("td",Pe,o(t.formatAmount(r==null?void 0:r.quarterly_payment)),1),e("td",Me,o(r!=null&&r.next_payment_due?t.formatDate(new Date(r==null?void 0:r.next_payment_due)):"N/A"),1),e("td",Ne,o(t.formatAmount(r==null?void 0:r.penalty)),1),e("td",Ie,[e("p",{class:X(["font-semibold",(r==null?void 0:r.current_payment)==="Paid"?"text-green-600":"text-red-600"])},o(r==null?void 0:r.current_payment),3)]),e("td",Fe,[c(t.Badge,{color:t.status(r.permits.status).color},{default:u(()=>[g(o(t.status(r.permits.status).status),1)]),_:2},1032,["color"])]),((k=(v=t.props)==null?void 0:v.filters)==null?void 0:k.role)!=="user"?(l(),d("td",Le,[c(t.Icons,{name:"cheveron-right",onClick:h=>t.getDetails(r),class:"block w-6 h-6 fill-primary"},null,8,["onClick"])])):_("",!0)])}),128)),((p=j.stallRentals)==null?void 0:p.total)===0?(l(),d("tr",be,[...s[7]||(s[7]=[e("td",{class:"px-6 py-4 border-t text-center",colspan:"12"},"No records found.",-1)])])):_("",!0)]}),_:1},8,["data"])]),e("div",qe,[c(t.Pagination,{links:(w=j.stallRentals)==null?void 0:w.links},null,8,["links"])]),c(t.Drawer,{modelValue:t.showDrawer,"onUpdate:modelValue":s[2]||(s[2]=n=>t.showDrawer=n),title:"Application Details",data:t.drawerData.value},{default:u(()=>{var n,p,r,N,C,B,S,A,v,k,h,V,i,x,q,E,O,T,U,H,Q,W,G;return[t.drawerData?(l(),d("div",Ee,[e("div",Oe,[e("div",Te,[e("div",Ue,[c(t.Icons,{name:"stalls",class:"w-6 h-6 fill-primary mt-1"}),e("div",null,[e("p",He,o(`Stall Leasing Application (${(p=(n=t.drawerData)==null?void 0:n.permits)==null?void 0:p.type})`),1),e("div",Qe,[c(t.Badge,{color:t.status((r=t.drawerData)==null?void 0:r.permits.status).color},{default:u(()=>{var a;return[g(o(t.status((a=t.drawerData)==null?void 0:a.permits.status).status),1)]}),_:1},8,["color"]),e("span",null,o(`â€¢ Applied ${t.formatDateShort(t.drawerData.permits.created_at)}`),1)])])]),((N=D.$page.props.auth.user)==null?void 0:N.role_id)===2?(l(),d("div",We,[e("button",{class:"flex items-center px-3 py-1.5 text-white bg-red-600 rounded-lg hover:bg-red-700 text-sm",onClick:t.rejectPermits},[...s[8]||(s[8]=[e("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:`M4.293 4.293a1 1 0 
                        011.414 0L10 8.586l4.293-4.293a1 1 0 
                        111.414 1.414L11.414 10l4.293 4.293a1 1 
                        01-1.414 1.414L10 11.414l-4.293 4.293a1 
                        1 0 01-1.414-1.414L8.586 10 4.293 
                        5.707a1 1 0 010-1.414z`,"clip-rule":"evenodd"})],-1),g(" Reject ",-1)])]),e("form",{onSubmit:ae(t.approveConfirm,["prevent"])},[...s[9]||(s[9]=[e("button",{class:"flex items-center px-3 py-1.5 text-white bg-green-600 rounded-lg hover:bg-green-700 text-sm"},[e("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:`M16.707 5.293a1 1 0 
                            010 1.414l-8 8a1 1 0 
                            01-1.414 0l-4-4a1 1 0 
                            011.414-1.414L8 12.586l7.293-7.293a1 1 
                            0 011.414 0z`,"clip-rule":"evenodd"})]),g(" Approve ")],-1)])],32)])):_("",!0)]),e("div",Ge,[s[20]||(s[20]=e("h3",{class:"text-md font-semibold mb-4 text-primary"},"Vendor Information",-1)),e("ul",Je,[e("li",Ke,[s[11]||(s[11]=e("svg",{class:"w-4 h-4 text-secondary",viewBox:"0 0 64 64",stroke:"currentColor",fill:"none"},[e("circle",{cx:"32",cy:"20",r:"8"}),e("path",{d:"M16 52c0-8 8-14 16-14s16 6 16 14"})],-1)),e("span",null,[s[10]||(s[10]=e("strong",{class:"text-secondary"},"Full Name: ",-1)),e("span",Xe,o(t.fullName((C=t.drawerData)==null?void 0:C.vendor)),1)])]),e("li",Ye,[s[13]||(s[13]=e("svg",{class:"w-4 h-4 text-secondary",viewBox:"0 0 64 64",stroke:"currentColor",fill:"none"},[e("rect",{x:"10",y:"16",width:"44",height:"32",rx:"4",ry:"4"}),e("polyline",{points:"10,16 32,36 54,16"})],-1)),e("span",null,[s[12]||(s[12]=e("strong",{class:"text-secondary"},"Email Address: ",-1)),e("span",Ze,o((S=(B=t.drawerData)==null?void 0:B.vendor)==null?void 0:S.email),1)])]),e("li",$e,[s[15]||(s[15]=e("svg",{class:"w-4 h-4 text-secondary",viewBox:"0 0 64 64",stroke:"currentColor",fill:"none"},[e("rect",{x:"20",y:"8",width:"24",height:"48",rx:"4",ry:"4"}),e("circle",{cx:"32",cy:"50",r:"2"})],-1)),e("span",null,[s[14]||(s[14]=e("strong",{class:"text-secondary"},"Phone Number: ",-1)),e("span",et,o((v=(A=t.drawerData)==null?void 0:A.vendor)==null?void 0:v.mobile),1)])]),e("li",tt,[s[17]||(s[17]=e("svg",{class:"w-4 h-4 text-secondary",viewBox:"0 0 64 64",stroke:"currentColor",fill:"none"},[e("path",{d:"M32 8c-8 0-14 6-14 14 0 10 14 26 14 26s14-16 14-26c0-8-6-14-14-14z"}),e("circle",{cx:"32",cy:"22",r:"4"})],-1)),e("span",null,[s[16]||(s[16]=e("strong",{class:"text-secondary"},"Address: ",-1)),e("span",st,o((h=(k=t.drawerData)==null?void 0:k.vendor)==null?void 0:h.address),1)])]),e("li",rt,[s[19]||(s[19]=e("svg",{class:"w-4 h-4 text-secondary",viewBox:"0 0 64 64",stroke:"currentColor",fill:"none"},[e("rect",{x:"10",y:"14",width:"44",height:"40",rx:"4",ry:"4"}),e("line",{x1:"10",y1:"24",x2:"54",y2:"24"}),e("line",{x1:"22",y1:"8",x2:"22",y2:"20"}),e("line",{x1:"42",y1:"8",x2:"42",y2:"20"}),e("circle",{cx:"32",cy:"38",r:"4"})],-1)),e("span",null,[s[18]||(s[18]=e("strong",{class:"text-secondary"},"Birthday: ",-1)),e("span",at,o(t.formatDateShort((i=(V=t.drawerData)==null?void 0:V.vendor)==null?void 0:i.birthday)),1)])])])]),e("div",ot,[s[23]||(s[23]=e("h3",{class:"text-md font-semibold mb-3 text-primary"},"Business Information",-1)),e("ul",lt,[e("li",nt,[c(t.Icons,{name:"business-names",class:"w-4 h-4 text-secondary"}),e("span",null,[s[21]||(s[21]=e("strong",{class:"text-secondary"},"Business Name: ",-1)),e("span",it,o((x=t.drawerData)==null?void 0:x.name),1)])]),e("li",dt,[c(t.Icons,{name:"business-category",class:"w-4 h-4 text-secondary"}),e("span",null,[s[22]||(s[22]=e("strong",{class:"text-secondary"},"Category: ",-1)),e("span",ct,o((O=(E=(q=t.drawerData)==null?void 0:q.stalls)==null?void 0:E.stallsCategories)==null?void 0:O.name),1)])])])]),e("div",mt,[s[25]||(s[25]=e("h3",{class:"text-sm font-semibold mb-3 text-primary"},"Requirements Submitted",-1)),e("ul",ut,[(l(!0),d(P,null,M(t.drawerData.requirements,(a,z)=>(l(),d("li",{key:z,class:"flex justify-between items-center bg-gray-50 px-4 py-2 rounded-lg shadow-sm"},[e("div",xt,[c(t.Icons,{name:"requirements",class:"w-5 h-5 fill-primary"}),e("span",ft,o(a.name),1)]),e("div",yt,[a.url?(l(),d("a",{key:0,href:`${a.url}/${a.attachment}`,class:"text-blue-600 hover:text-blue-800 text-sm underline",target:"_blank"},"[View]",8,pt)):_("",!0),a.url?(l(),d("button",{key:1,onClick:L=>t.printAttachment(`${a.url}/${a.attachment}`),class:"flex items-center text-green-600 hover:text-green-800 text-sm"},[...s[24]||(s[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 9V2h12v7M6 18h12v4H6v-4zM6 14h12a2 2 0 002-2V9a2 2 0 00-2-2H6a2 2 0 00-2 2v3a2 2 0 002 2z"})],-1),g(" Print ",-1)])],8,gt)):_("",!0)])]))),128))])]),e("div",ht,[s[28]||(s[28]=e("h3",{class:"text-md font-semibold text-primary"},"Payments",-1)),e("ul",_t,[(l(!0),d(P,null,M((U=(T=t.drawerData)==null?void 0:T.paymentDetails)==null?void 0:U.breakdown,(a,z)=>(l(),d("li",{key:z,class:"flex justify-between bg-gray-50 px-4 py-2 rounded-lg shadow-sm"},[e("span",null,[e("strong",wt,o(a==null?void 0:a.type)+":",1),s[26]||(s[26]=g()),e("span",vt,o(t.formatAmount(a==null?void 0:a.amount)),1)])]))),128)),e("li",kt,[s[27]||(s[27]=e("strong",{class:"text-secondary"},"Total:",-1)),e("span",Dt,o(t.formatAmount((H=t.drawerData)==null?void 0:H.quarterly_payment)),1)])])]),((W=(Q=t.drawerData)==null?void 0:Q.approvals)==null?void 0:W.length)>0?(l(),d("div",jt,[s[29]||(s[29]=e("h3",{class:"text-md font-semibold text-primary"},"Approvals",-1)),e("ul",Ct,[(l(!0),d(P,null,M((G=t.drawerData)==null?void 0:G.approvals,(a,z)=>{var L,J;return l(),d("li",{key:z,class:"flex justify-between bg-gray-50 px-4 py-2 rounded-lg shadow-sm"},[e("span",null,[e("strong",Bt,o(a==null?void 0:a.department)+": ",1),e("span",St,o(`${(L=a==null?void 0:a.approver)==null?void 0:L.name} (${(J=a==null?void 0:a.approver)==null?void 0:J.position}) - ${(a==null?void 0:a.status)===1?"Approved":"Rejected"}`),1)])])}),128))])])):_("",!0)])])):_("",!0)]}),_:1},8,["modelValue","data"]),c(t.ConfirmationModal,{show:t.isRejected,onClose:t.closeRejection},{title:u(()=>[...s[30]||(s[30]=[g(" Reject Request ",-1)])]),content:u(()=>{var n,p;return[e("div",At,[s[31]||(s[31]=e("p",{class:"text-gray-700 text-sm md:text-base"}," Are you sure you would like to reject this request? Please provide a reason below: ",-1)),e("div",null,[K(e("textarea",{id:"remarks","onUpdate:modelValue":s[3]||(s[3]=r=>t.forms.remarks=r),rows:"3",required:"",placeholder:"Enter your reason for rejection...",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm resize-none"},null,512),[[oe,t.forms.remarks]]),c(m,{class:"mt-2",message:(p=(n=t.form)==null?void 0:n.errors)==null?void 0:p.remarks},null,8,["message"])])])]}),footer:u(()=>[e("div",Rt,[c(t.SecondaryButton,{onClick:t.closeRejection},{default:u(()=>[...s[32]||(s[32]=[g(" Cancel ",-1)])]),_:1}),e("form",{onSubmit:t.rejectConfirm},[c(t.DangerButton,{disabled:!t.forms.remarks,onClick:t.rejectConfirm,class:"disabled:opacity-50"},{default:u(()=>[...s[33]||(s[33]=[g(" Reject ",-1)])]),_:1},8,["disabled"])],32)])]),_:1},8,["show"])]}),_:1})}const Kt=ve(ke,[["render",Vt],["__file","StallRental.vue"]]);export{Kt as default};
