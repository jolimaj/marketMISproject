import{d as a,o as t,a as l,b as s,s as j,w as r,f as c,n as C,t as x,V as K,g as u,h as A,E as B,c as h,e as m,F as O,r as Q,H as E,u as I,L as V,i as R,j as k}from"./app-Dn5hSVff.js";import{D as Y,A as U}from"./DialogModal--yguMgwx.js";import{I as M}from"./InputError-4rRk2-F3.js";import{P as D}from"./PrimaryButton-CKMMsEVR.js";import{S as L}from"./SecondaryButton-vnumFzDe.js";import{T as q}from"./TextInput-hVIJxIGZ.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{D as z}from"./DangerButton-Dhxia5dL.js";import{I as G}from"./InputLabel-DphVoaUg.js";import"./SectionTitle-FgM-SPMB.js";import"./Modal-Bf-Vm8tS.js";const W={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(v,{expose:e,emit:f}){e();const o=f,d=u(!1),n=A({password:"",error:"",processing:!1}),i=u(null),_=()=>{axios.get(route("password.confirmation")).then(y=>{y.data.confirmed?o("confirmed"):(d.value=!0,setTimeout(()=>i.value.focus(),250))})},b=()=>{n.processing=!0,axios.post(route("password.confirm"),{password:n.password}).then(()=>{n.processing=!1,p(),B().then(()=>o("confirmed"))}).catch(y=>{n.processing=!1,n.error=y.response.data.errors.password[0],i.value.focus()})},p=()=>{d.value=!1,n.password="",n.error=""},w={emit:o,confirmingPassword:d,form:n,passwordInput:i,startConfirmingPassword:_,confirmPassword:b,closeModal:p,ref:u,reactive:A,nextTick:B,DialogModal:Y,InputError:M,PrimaryButton:D,SecondaryButton:L,TextInput:q};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},J={class:"mt-4"};function X(v,e,f,o,d,n){return t(),a("span",null,[l("span",{onClick:o.startConfirmingPassword},[j(v.$slots,"default")]),s(o.DialogModal,{show:o.confirmingPassword,onClose:o.closeModal},{title:r(()=>[c(x(f.title),1)]),content:r(()=>[c(x(f.content)+" ",1),l("div",J,[s(o.TextInput,{ref:"passwordInput",modelValue:o.form.password,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.password=i),type:"password",class:"mt-1 block w-3/4",placeholder:"Password",autocomplete:"current-password",onKeyup:K(o.confirmPassword,["enter"])},null,8,["modelValue"]),s(o.InputError,{message:o.form.error,class:"mt-2"},null,8,["message"])])]),footer:r(()=>[s(o.SecondaryButton,{onClick:o.closeModal},{default:r(()=>[...e[1]||(e[1]=[c(" Cancel ",-1)])]),_:1}),s(o.PrimaryButton,{class:C(["ms-3",{"opacity-25":o.form.processing}]),disabled:o.form.processing,onClick:o.confirmPassword},{default:r(()=>[c(x(f.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])])}const Z=H(W,[["render",X],["__file","ConfirmsPassword.vue"]]),$={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(v,{expose:e}){e();const f=v,o=E(),d=u(!1),n=u(!1),i=u(!1),_=u(null),b=u(null),p=u([]),w=I({code:""}),y=V(()=>{var g;return!d.value&&((g=o.props.auth.user)==null?void 0:g.two_factor_enabled)});R(y,()=>{y.value||(w.reset(),w.clearErrors())});const N=()=>{d.value=!0,k.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([T(),P(),F()]),onFinish:()=>{d.value=!1,n.value=f.requiresConfirmation}})},T=()=>axios.get(route("two-factor.qr-code")).then(g=>{_.value=g.data.svg}),P=()=>axios.get(route("two-factor.secret-key")).then(g=>{b.value=g.data.secretKey}),F=()=>axios.get(route("two-factor.recovery-codes")).then(g=>{p.value=g.data}),S={props:f,page:o,enabling:d,confirming:n,disabling:i,qrCode:_,setupKey:b,recoveryCodes:p,confirmationForm:w,twoFactorEnabled:y,enableTwoFactorAuthentication:N,showQrCode:T,showSetupKey:P,showRecoveryCodes:F,confirmTwoFactorAuthentication:()=>{w.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{n.value=!1,_.value=null,b.value=null}})},regenerateRecoveryCodes:()=>{axios.post(route("two-factor.recovery-codes")).then(()=>F())},disableTwoFactorAuthentication:()=>{i.value=!0,k.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{i.value=!1,n.value=!1}})},ref:u,computed:V,watch:R,get router(){return k},get useForm(){return I},get usePage(){return E},ActionSection:U,ConfirmsPassword:Z,DangerButton:z,InputError:M,InputLabel:G,PrimaryButton:D,SecondaryButton:L,TextInput:q};return Object.defineProperty(S,"__isScriptSetup",{enumerable:!1,value:!0}),S}},oo={key:0,class:"text-lg font-medium text-gray-900"},eo={key:1,class:"text-lg font-medium text-gray-900"},to={key:2,class:"text-lg font-medium text-gray-900"},ro={key:3},no={key:0},ao={class:"mt-4 max-w-xl text-sm text-gray-600"},so={key:0,class:"font-semibold"},io={key:1},co=["innerHTML"],lo={key:0,class:"mt-4 max-w-xl text-sm text-gray-600"},mo={class:"font-semibold"},uo=["innerHTML"],fo={key:1,class:"mt-4"},go={key:1},wo={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg"},yo={class:"mt-5"},ho={key:0},vo={key:1};function _o(v,e,f,o,d,n){return t(),h(o.ActionSection,null,{title:r(()=>[...e[1]||(e[1]=[c(" Two Factor Authentication ",-1)])]),description:r(()=>[...e[2]||(e[2]=[c(" Add additional security to your account using two factor authentication. ",-1)])]),content:r(()=>[o.twoFactorEnabled&&!o.confirming?(t(),a("h3",oo," You have enabled two factor authentication. ")):o.twoFactorEnabled&&o.confirming?(t(),a("h3",eo," Finish enabling two factor authentication. ")):(t(),a("h3",to," You have not enabled two factor authentication. ")),e[11]||(e[11]=l("div",{class:"mt-3 max-w-xl text-sm text-gray-600"},[l("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),o.twoFactorEnabled?(t(),a("div",ro,[o.qrCode?(t(),a("div",no,[l("div",ao,[o.confirming?(t(),a("p",so," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(t(),a("p",io," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),l("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:o.qrCode},null,8,co),o.setupKey?(t(),a("div",lo,[l("p",mo,[e[3]||(e[3]=c(" Setup Key: ",-1)),l("span",{innerHTML:o.setupKey},null,8,uo)])])):m("",!0),o.confirming?(t(),a("div",fo,[s(o.InputLabel,{for:"code",value:"Code"}),s(o.TextInput,{id:"code",modelValue:o.confirmationForm.code,"onUpdate:modelValue":e[0]||(e[0]=i=>o.confirmationForm.code=i),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:K(o.confirmTwoFactorAuthentication,["enter"])},null,8,["modelValue"]),s(o.InputError,{message:o.confirmationForm.errors.code,class:"mt-2"},null,8,["message"])])):m("",!0)])):m("",!0),o.recoveryCodes.length>0&&!o.confirming?(t(),a("div",go,[e[4]||(e[4]=l("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[l("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),l("div",wo,[(t(!0),a(O,null,Q(o.recoveryCodes,i=>(t(),a("div",{key:i},x(i),1))),128))])])):m("",!0)])):m("",!0),l("div",yo,[o.twoFactorEnabled?(t(),a("div",vo,[s(o.ConfirmsPassword,{onConfirmed:o.confirmTwoFactorAuthentication},{default:r(()=>[o.confirming?(t(),h(o.PrimaryButton,{key:0,type:"button",class:C(["me-3",{"opacity-25":o.enabling||o.confirmationForm.processing}]),disabled:o.enabling||o.confirmationForm.processing},{default:r(()=>[...e[6]||(e[6]=[c(" Confirm ",-1)])]),_:1},8,["class","disabled"])):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.regenerateRecoveryCodes},{default:r(()=>[o.recoveryCodes.length>0&&!o.confirming?(t(),h(o.SecondaryButton,{key:0,class:"me-3"},{default:r(()=>[...e[7]||(e[7]=[c(" Regenerate Recovery Codes ",-1)])]),_:1})):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.showRecoveryCodes},{default:r(()=>[o.recoveryCodes.length===0&&!o.confirming?(t(),h(o.SecondaryButton,{key:0,class:"me-3"},{default:r(()=>[...e[8]||(e[8]=[c(" Show Recovery Codes ",-1)])]),_:1})):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.disableTwoFactorAuthentication},{default:r(()=>[o.confirming?(t(),h(o.SecondaryButton,{key:0,class:C({"opacity-25":o.disabling}),disabled:o.disabling},{default:r(()=>[...e[9]||(e[9]=[c(" Cancel ",-1)])]),_:1},8,["class","disabled"])):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.disableTwoFactorAuthentication},{default:r(()=>[o.confirming?m("",!0):(t(),h(o.DangerButton,{key:0,class:C({"opacity-25":o.disabling}),disabled:o.disabling},{default:r(()=>[...e[10]||(e[10]=[c(" Disable ",-1)])]),_:1},8,["class","disabled"]))]),_:1})])):(t(),a("div",ho,[s(o.ConfirmsPassword,{onConfirmed:o.enableTwoFactorAuthentication},{default:r(()=>[s(o.PrimaryButton,{type:"button",class:C({"opacity-25":o.enabling}),disabled:o.enabling},{default:r(()=>[...e[5]||(e[5]=[c(" Enable ",-1)])]),_:1},8,["class","disabled"])]),_:1})]))])]),_:1})}const Ro=H($,[["render",_o],["__file","TwoFactorAuthenticationForm.vue"]]);export{Ro as default};
