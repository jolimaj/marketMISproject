import{c as I,o as p,w as i,a as o,b as s,e as P,m as Y,d as D,F as T,r as B,t as c,v as b,n as A,f as S,p as G,g as N,h as R,u as L,i as M,j,l as K}from"./app-C9RkxTMI.js";import{l as C,p as E}from"./pickBy-LDO_7Tw4.js";import{S as X,a as U,E as O}from"./SingleFileUpload-DiAbdopy.js";import{A as H}from"./AppLayout-BZrSIs-V.js";import{B as J}from"./BaseTable-sNG9Y-7_.js";import{P as Q}from"./Pagination-_9G9XWTt.js";import{I as W}from"./Icons-CNOXkTqW.js";import{f as q,b as Z,c as z}from"./helper-ugt-wfEi.js";import{B as $}from"./Badge-C4IE0RAu.js";import{F as ee}from"./FlashMessage-Jt5JEgTl.js";import{S as te}from"./SearchFilter-hfDYmbbv.js";import{C as ae}from"./ConfirmationModal-mxzxap64.js";import{S as oe}from"./SecondaryButton-CwTMIRNe.js";import{I as re}from"./InputLabel-D-J_fIdO.js";import{T as le}from"./TextInput-BsID4eDm.js";import{I as se}from"./InputError-Cu5q8nQX.js";import{L as ne}from"./LoadingButton-UUFiRY4D.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logo-B9Pz234s.js";import"./Footer-BfZ7mAup.js";import"./Modal-bmjLihdU.js";const me={__name:"VolanteRental",props:{volanteRentals:Object,filters:Object},setup(h,{expose:a}){var m,k;a();const u=N(!1),e=N(null),F=["Rental No.","Vendor","Business Name","Slot","Duration","Type","Monthly Payment","Due Date","Penalty","Current Payment","Status",""],f=h,d=R({search:(m=f==null?void 0:f.filters)==null?void 0:m.search,type:(k=f==null?void 0:f.filters)==null?void 0:k.type}),y=L({receipt:null,reference_number:"",amount:0,volantes_id:null});M(d,C.throttle(()=>{j.get("/my-rentals/market-volante",E(d),{preserveState:!0})},150),{deep:!0});const n=l=>{let r={color:"blue",status:"Vacant"};switch(l){case 3:r={color:"orange",status:"Expired"};break;case 2:r={color:"red",status:"Rejected"};break;case 1:r={color:"green",status:"Approved"};break;default:r={color:"blue",status:"Pending"}}return r},_=[{id:1,name:"New"},{id:2,name:"Renewal"}];function t(){d.search="",d.type=null,Object.assign(d,mapValues(d,()=>null))}function V(){u.value=!1}function v(l){e.value=l,y.amount=l==null?void 0:l.quarterly_payment,y.volantes_id=Number(l==null?void 0:l.id),u.value=!0}const x=l=>{const r=new O;r.setFontSize(18),r.text("MARKETMIS - Payment Invoice",14,20),r.setFontSize(12),r.text(`Invoice Date: ${l.date}`,14,35),r.text(`Transaction ID: ${l.transaction_id}`,14,42),r.text(`Volante Name: ${l.applicant_name}`,14,49),r.text(`Payment Method: ${l.payment_method}`,14,56),U(r,{startY:70,head:[["Description","Amount"]],body:[["Volante Rental Payment",`${z(l.amount)}`]],theme:"grid"}),r.setFontSize(14),r.text(`Total: ${z(l.amount)}`,150,r.lastAutoTable.finalY+10),r.setFontSize(10),r.text("Thank you for your payment!",14,r.lastAutoTable.finalY+20),r.text("Generated by MarketMIS",14,r.lastAutoTable.finalY+26),r.save(`Invoice-${l.transaction_id}.pdf`)},g={isPayment:u,payee:e,headers:F,props:f,form:d,formData:y,status:n,statusOptions:_,reset:t,cancelPayment:V,payNow:v,generateInvoicePDF:x,submit:()=>{y.post(route("applications.payment"),{onSuccess:()=>{var l;x({applicant_name:q((l=e.value)==null?void 0:l.vendor),transaction_id:`TXN-${Date.now()}`,amount:e.value.quarterly_payment,date:new Date().toLocaleDateString(),payment_method:"Lizbiz Pay"}),y.reset(),u.value=!1}})},watch:M,reactive:R,ref:N,get Link(){return K},get router(){return j},get useForm(){return L},get throttle(){return C.throttle},get pickBy(){return E},get jsPDF(){return O},get autoTable(){return U},AppLayout:H,BaseTable:J,Pagination:Q,Icon:W,get formatAmount(){return z},get formatDate(){return Z},get fullName(){return q},Badge:$,FlashMessage:ee,SearchFilter:te,ConfirmationModal:ae,SecondaryButton:oe,InputLabel:re,TextInput:le,InputError:se,SingleFileUpload:X,LoadingButton:ne};return Object.defineProperty(g,"__isScriptSetup",{enumerable:!1,value:!0}),g}},ce={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},de={class:"flex items-center justify-between mb-6"},ue=["value"],pe={class:"px-4 py-3 capitalize text-center"},fe={class:"px-4 py-3 capitalize text-center"},ye={class:"px-4 py-3 capitalize text-center"},xe={class:"px-4 py-3 capitalize text-center"},ge={class:"px-4 py-3 capitalize text-center"},_e={class:"px-4 py-3 capitalize text-center"},ve={class:"px-4 py-3 capitalize text-center"},he={class:"px-4 py-3 capitalize text-center"},we={class:"px-4 py-3 capitalize text-center"},ke={class:"px-4 py-3 capitalize text-center"},De={key:0,class:"font-semibold text-blue-600"},Se=["disabled","onClick"],Ve={class:"px-4 py-3 capitalize text-center"},Pe={class:"px-4 py-3 capitalize"},Ie={key:0},Ne={class:"mt-6 flex justify-center"},ze={class:"space-y-4 p-4 text-left"},Fe={class:"flex flex-col md:flex-row gap-4 mt-5"},Te={class:"w-full"},Be={class:"flex flex-col md:flex-row gap-4 mt-5"},Ae={class:"w-full"},Re={class:"w-full"},Le={class:"flex justify-end space-x-3 p-4"};function Me(h,a,u,e,F,f){return p(),I(e.AppLayout,{title:"Stalls"},{header:i(()=>[...a[5]||(a[5]=[o("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Stall ",-1)])]),default:i(()=>{var d,y;return[a[16]||(a[16]=o("h1",{class:"mb-8 text-3xl font-bold text-primary"},"Market Volante",-1)),o("div",ce,[h.$page.props.flash.success?(p(),I(e.FlashMessage,{key:0,message:h.$page.props.flash.success,type:"success"},null,8,["message"])):P("",!0),h.$page.props.flash.error?(p(),I(e.FlashMessage,{key:1,message:h.$page.props.flash.error,type:"error"},null,8,["message"])):P("",!0),o("div",de,[s(e.SearchFilter,{modelValue:e.form.search,"onUpdate:modelValue":a[1]||(a[1]=n=>e.form.search=n),class:"mr-4 w-full max-w-md",onReset:e.reset},{default:i(()=>[a[7]||(a[7]=o("label",{class:"block text-gray-700"},"Type:",-1)),Y(o("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>e.form.type=n),class:"form-select mt-1 w-full"},[a[6]||(a[6]=o("option",{value:null},"All",-1)),(p(),D(T,null,B(e.statusOptions,n=>o("option",{key:n.id,value:n.id},c(n.name),9,ue)),64))],512),[[b,e.form.type]])]),_:1},8,["modelValue"]),s(e.Link,{type:"submit",class:A([{"opacity-25":e.form.processing},"bg-btn-gradient text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors"]),disabled:e.form.processing,href:"/my-rentals/market-volante/create"},{default:i(()=>[...a[8]||(a[8]=[S("Apply Now",-1)])]),_:1},8,["class","disabled"])]),s(e.BaseTable,{headers:e.headers,data:(d=u.volanteRentals)==null?void 0:d.data,class:A("center text-center sticky right-0 bg-white z-10")},{row:i(({data:n})=>{var _;return[(p(!0),D(T,null,B(n,(t,V)=>{var v,x,w,g,m;return p(),D("tr",{key:u.volanteRentals.id,class:"hover:bg-gray-50"},[o("td",pe,c((v=t==null?void 0:t.permits)!=null&&v.permit_number?`${(x=t==null?void 0:t.permits)==null?void 0:x.permit_number}`:"-"),1),o("td",fe,c(`${e.fullName(t==null?void 0:t.vendor)}`),1),o("td",ye,c(t.name),1),o("td",xe,c((w=t==null?void 0:t.stalls)==null?void 0:w.name),1),o("td",ge,c(t!=null&&t.start_date&&(t!=null&&t.end_date)?`${e.formatDate(t.start_date)} - ${e.formatDate(t.end_date)}`:"-"),1),o("td",_e,[s(e.Badge,{color:((g=t==null?void 0:t.permits)==null?void 0:g.type)==="new"?"green":"blue"},{default:i(()=>{var k;return[S(c((k=t==null?void 0:t.permits)==null?void 0:k.type),1)]}),_:2},1032,["color"])]),o("td",ve,c(e.formatAmount(t==null?void 0:t.quarterly_payment)),1),o("td",he,c(t!=null&&t.next_payment_due?e.formatDate(new Date(t==null?void 0:t.next_payment_due)):"N/A"),1),o("td",we,c(e.formatAmount(t==null?void 0:t.penalty)),1),o("td",ke,[(t==null?void 0:t.current_payment)==="Paid"?(p(),D("p",De,"Paid")):P("",!0),(t==null?void 0:t.current_payment)==="Not Paid"?(p(),D("button",{key:1,disabled:((m=t==null?void 0:t.permits)==null?void 0:m.status)!==1,class:"inline-block bg-blue-600 text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors",onClick:k=>e.payNow(t),tabindex:"-1"}," Pay Now ",8,Se)):P("",!0)]),o("td",Ve,[s(e.Badge,{color:e.status(t.permits.status).color},{default:i(()=>[S(c(e.status(t.permits.status).status),1)]),_:2},1032,["color"])]),o("td",Pe,[s(e.Link,{class:"flex items-center pr-2",href:`/my-rentals/market-volante/${t.id}`,tabindex:"-1"},{default:i(()=>[s(e.Icon,{name:"cheveron-right",class:"block w-6 h-6 fill-primary"})]),_:1},8,["href"])])])}),128)),((_=u.volanteRentals)==null?void 0:_.total)===0?(p(),D("tr",Ie,[...a[9]||(a[9]=[o("td",{class:"px-6 py-4 border-t text-center",colspan:"7"},"No records found.",-1)])])):P("",!0)]}),_:1},8,["data"])]),o("div",Ne,[s(e.Pagination,{links:(y=u.volanteRentals)==null?void 0:y.links},null,8,["links"])]),s(e.ConfirmationModal,{show:e.isPayment,onClose:e.cancelPayment},{title:i(()=>[...a[10]||(a[10]=[S(" Pay Now ",-1)])]),content:i(()=>{var n,_,t,V,v,x,w,g;return[o("div",ze,[a[11]||(a[11]=o("p",{class:"text-gray-600"},"Please complete your payment below:",-1)),a[12]||(a[12]=o("iframe",{src:"https://www.lbp-eservices.com/egps/portal/Fields.jsp",class:"w-full h-96 border rounded-md"},null,-1)),o("div",Fe,[o("div",Te,[s(e.InputLabel,{for:"receipt",value:"Receipt",class:"mb-1 block w-full"}),s(e.SingleFileUpload,{modelValue:e.formData.receipt,"onUpdate:modelValue":a[2]||(a[2]=m=>e.formData.receipt=m),label:"Upload Official Receipt",accept:".jpg,.jpeg,.png,.pdf",class:"mt-1 block w-full",error:(_=(n=e.formData)==null?void 0:n.errors)==null?void 0:_.receipt},null,8,["modelValue","error"]),s(e.InputError,{class:"mt-2",message:(V=(t=e.formData)==null?void 0:t.errors)==null?void 0:V.receipt},null,8,["message"])])]),o("div",Be,[o("div",Ae,[s(e.InputLabel,{for:"amount",value:"Amount"}),s(e.TextInput,{id:"amount",modelValue:e.formData.amount,"onUpdate:modelValue":a[3]||(a[3]=m=>e.formData.amount=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"amount"},null,8,["modelValue"]),s(e.InputError,{class:"mt-2",message:(x=(v=e.formData)==null?void 0:v.errors)==null?void 0:x.amount},null,8,["message"])]),o("div",Re,[s(e.InputLabel,{for:"reference_number",value:"Reference Number"}),s(e.TextInput,{id:"reference_number",modelValue:e.formData.reference_number,"onUpdate:modelValue":a[4]||(a[4]=m=>e.formData.reference_number=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"reference_number"},null,8,["modelValue"]),s(e.InputError,{class:"mt-2",message:(g=(w=e.formData)==null?void 0:w.errors)==null?void 0:g.reference_number},null,8,["message"])])])])]}),footer:i(()=>[o("div",Le,[s(e.SecondaryButton,{onClick:e.cancelPayment},{default:i(()=>[...a[13]||(a[13]=[S(" Cancel ",-1)])]),_:1}),o("form",{onSubmit:G(e.submit,["prevent"])},[s(e.LoadingButton,{loading:e.form.processing,class:"bg-primary ml-auto",type:"submit"},{default:i(()=>[...a[14]||(a[14]=[S(" Submit ",-1)])]),_:1},8,["loading"])],32)])]),default:i(()=>[a[15]||(a[15]=o("div",null,null,-1))]),_:1},8,["show"])]}),_:1})}const rt=ie(me,[["render",Me],["__file","VolanteRental.vue"]]);export{rt as default};
