import{c as I,o as p,w as i,a as o,b as s,e as P,m as q,d as D,F as V,r as F,t as c,v as Y,n as R,f as S,p as G,g as N,h as B,u as A,i as L,j,l as K}from"./app-BanCskK_.js";import{l as C,p as M}from"./pickBy-CADBopQR.js";import{S as Q,a as E,E as U}from"./SingleFileUpload-CCAqswaD.js";import{A as X}from"./AppLayout-C4XkhOEP.js";import{B as H}from"./BaseTable-DqakuR4C.js";import{P as J}from"./Pagination-CEk2Xf0e.js";import{I as W}from"./Icons-DEAzJamH.js";import{f as O,b as Z,c as b}from"./helper-ugt-wfEi.js";import{B as $}from"./Badge-JyrJPy6d.js";import{F as ee}from"./FlashMessage-BuMPzACp.js";import{S as te}from"./SearchFilter-Ds2KTKLN.js";import{C as ae}from"./ConfirmationModal-BnX2MBGg.js";import{S as oe}from"./SecondaryButton-D4pPHRxf.js";import{I as re}from"./InputLabel-DEGwxhMC.js";import{T as le}from"./TextInput-Ds5jS_tB.js";import{I as se}from"./InputError-BURk-VOo.js";import{L as ne}from"./LoadingButton-DfFYCWyC.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logo-BNihBzbJ.js";import"./Footer-qu4Jt-lS.js";import"./Modal-D_qkctnO.js";const me={__name:"TableRental",props:{tableRentals:Object,filters:Object},setup(w,{expose:a}){var m,k;a();const u=N(!1),e=N(null),z=["Rental No.","Vendor","Business Name","Table","Duration","Type","Quarterly Payment","Due Date","Penalty","Current Payment","Status",""],f=w,d=B({search:(m=f==null?void 0:f.filters)==null?void 0:m.search,type:(k=f==null?void 0:f.filters)==null?void 0:k.type}),y=A({receipt:null,reference_number:"",amount:0,table_rental_id:null});L(d,C.throttle(()=>{j.get("/my-rentals/table-spaces",M(d),{preserveState:!0})},150),{deep:!0});const n=l=>{let r={color:"blue",status:"Vacant"};switch(l){case 3:r={color:"orange",status:"Expired"};break;case 2:r={color:"red",status:"Rejected"};break;case 1:r={color:"green",status:"Approved"};break;default:r={color:"blue",status:"Pending"}}return r},g=[{id:1,name:"New"},{id:2,name:"Renewal"}];function t(){d.search="",d.type=null,Object.assign(d,mapValues(d,()=>null))}function T(){u.value=!1}function h(l){e.value=l,y.amount=l==null?void 0:l.quarterly_payment,y.table_rental_id=Number(l==null?void 0:l.id),u.value=!0}const x=l=>{const r=new U;r.setFontSize(18),r.text("MARKETMIS - Payment Invoice",14,20),r.setFontSize(12),r.text(`Invoice Date: ${l.date}`,14,35),r.text(`Transaction ID: ${l.transaction_id}`,14,42),r.text(`Table Renter Name: ${l.applicant_name}`,14,49),r.text(`Payment Method: ${l.payment_method}`,14,56),E(r,{startY:70,head:[["Description","Amount"]],body:[["Table Rental Payment",`${b(l.amount)}`]],theme:"grid"}),r.setFontSize(14),r.text(`Total: ${b(l.amount)}`,150,r.lastAutoTable.finalY+10),r.setFontSize(10),r.text("Thank you for your payment!",14,r.lastAutoTable.finalY+20),r.text("Generated by MarketMIS",14,r.lastAutoTable.finalY+26),r.save(`Invoice-${l.transaction_id}.pdf`)},_={isPayment:u,payee:e,headers:z,props:f,form:d,formData:y,status:n,statusOptions:g,reset:t,cancelPayment:T,payNow:h,generateInvoicePDF:x,submit:()=>{y.post(route("applications.payment"),{onSuccess:()=>{var l;x({applicant_name:O((l=e.value)==null?void 0:l.vendor),transaction_id:`TXN-${Date.now()}`,amount:e.value.quarterly_payment,date:new Date().toLocaleDateString(),payment_method:"Lizbiz Pay"}),y.reset(),u.value=!1}})},watch:L,reactive:B,ref:N,get Link(){return K},get router(){return j},get useForm(){return A},get throttle(){return C.throttle},get pickBy(){return M},get jsPDF(){return U},get autoTable(){return E},AppLayout:X,BaseTable:H,Pagination:J,Icon:W,get formatAmount(){return b},get formatDate(){return Z},get fullName(){return O},Badge:$,FlashMessage:ee,SearchFilter:te,ConfirmationModal:ae,SecondaryButton:oe,InputLabel:re,TextInput:le,InputError:se,SingleFileUpload:Q,LoadingButton:ne};return Object.defineProperty(_,"__isScriptSetup",{enumerable:!1,value:!0}),_}},ce={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},de={class:"flex items-center justify-between mb-6"},ue=["value"],pe={class:"px-4 py-3 capitalize text-center"},fe={class:"px-4 py-3 capitalize text-center"},ye={class:"px-4 py-3 capitalize text-center"},xe={class:"px-4 py-3 capitalize text-center"},_e={class:"px-4 py-3 capitalize text-center"},ge={class:"px-4 py-3 capitalize text-center"},he={class:"px-4 py-3 capitalize text-center"},we={class:"px-4 py-3 capitalize text-center"},ve={class:"px-4 py-3 capitalize text-center"},ke={class:"px-4 py-3 capitalize text-center"},De={key:0,class:"font-semibold text-blue-600"},Se=["disabled","onClick"],Te={class:"px-4 py-3 capitalize text-center"},Pe={class:"px-4 py-3 capitalize"},Ie={key:0},Ne={class:"mt-6 flex justify-center"},be={class:"space-y-4 p-4 text-left"},ze={class:"flex flex-col md:flex-row gap-4 mt-5"},Ve={class:"w-full"},Fe={class:"flex flex-col md:flex-row gap-4 mt-5"},Re={class:"w-full"},Be={class:"w-full"},Ae={class:"flex justify-end space-x-3 p-4"};function Le(w,a,u,e,z,f){return p(),I(e.AppLayout,{title:"Stalls"},{header:i(()=>[...a[5]||(a[5]=[o("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Stall ",-1)])]),default:i(()=>{var d,y;return[a[16]||(a[16]=o("h1",{class:"mb-8 text-3xl font-bold text-primary"},"Table Spaces",-1)),o("div",ce,[w.$page.props.flash.success?(p(),I(e.FlashMessage,{key:0,message:w.$page.props.flash.success,type:"success"},null,8,["message"])):P("",!0),w.$page.props.flash.error?(p(),I(e.FlashMessage,{key:1,message:w.$page.props.flash.error,type:"error"},null,8,["message"])):P("",!0),o("div",de,[s(e.SearchFilter,{modelValue:e.form.search,"onUpdate:modelValue":a[1]||(a[1]=n=>e.form.search=n),class:"mr-4 w-full max-w-md",onReset:e.reset},{default:i(()=>[a[7]||(a[7]=o("label",{class:"block text-gray-700"},"Type:",-1)),q(o("select",{"onUpdate:modelValue":a[0]||(a[0]=n=>e.form.type=n),class:"form-select mt-1 w-full"},[a[6]||(a[6]=o("option",{value:null},"All",-1)),(p(),D(V,null,F(e.statusOptions,n=>o("option",{key:n.id,value:n.id},c(n.name),9,ue)),64))],512),[[Y,e.form.type]])]),_:1},8,["modelValue"]),s(e.Link,{type:"submit",class:R([{"opacity-25":e.form.processing},"bg-btn-gradient text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors"]),disabled:e.form.processing,href:"/my-rentals/table-spaces/create"},{default:i(()=>[...a[8]||(a[8]=[S("Rent New",-1)])]),_:1},8,["class","disabled"])]),s(e.BaseTable,{headers:e.headers,data:(d=u.tableRentals)==null?void 0:d.data,class:R("center text-center sticky right-0 bg-white z-10")},{row:i(({data:n})=>{var g;return[(p(!0),D(V,null,F(n,(t,T)=>{var h,x,v,_,m;return p(),D("tr",{key:u.tableRentals.id,class:"hover:bg-gray-50"},[o("td",pe,c((h=t==null?void 0:t.permits)!=null&&h.permit_number?`${(x=t==null?void 0:t.permits)==null?void 0:x.permit_number}`:"-"),1),o("td",fe,c(`${e.fullName(t==null?void 0:t.vendor)}`),1),o("td",ye,c(t.name),1),o("td",xe,c((v=t==null?void 0:t.stalls)==null?void 0:v.name),1),o("td",_e,c(t!=null&&t.start_date&&(t!=null&&t.end_date)?`${e.formatDate(t.start_date)} - ${e.formatDate(t.end_date)}`:"-"),1),o("td",ge,[s(e.Badge,{color:((_=t==null?void 0:t.permits)==null?void 0:_.type)==="new"?"green":"blue"},{default:i(()=>{var k;return[S(c((k=t==null?void 0:t.permits)==null?void 0:k.type),1)]}),_:2},1032,["color"])]),o("td",he,c(e.formatAmount(t==null?void 0:t.quarterly_payment)),1),o("td",we,c(t!=null&&t.next_payment_due?e.formatDate(new Date(t==null?void 0:t.next_payment_due)):"N/A"),1),o("td",ve,c(e.formatAmount(t==null?void 0:t.penalty)),1),o("td",ke,[(t==null?void 0:t.current_payment)==="Paid"?(p(),D("p",De,"Paid")):P("",!0),(t==null?void 0:t.current_payment)==="Not Paid"?(p(),D("button",{key:1,disabled:((m=t==null?void 0:t.permits)==null?void 0:m.status)!==1,class:"inline-block bg-blue-600 text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors",onClick:k=>e.payNow(t),tabindex:"-1"}," Pay Now ",8,Se)):P("",!0)]),o("td",Te,[s(e.Badge,{color:e.status(t.permits.status).color},{default:i(()=>[S(c(e.status(t.permits.status).status),1)]),_:2},1032,["color"])]),o("td",Pe,[s(e.Link,{class:"flex items-center pr-2",href:`/my-rentals/table-spaces/${t.id}`,tabindex:"-1"},{default:i(()=>[s(e.Icon,{name:"cheveron-right",class:"block w-6 h-6 fill-primary"})]),_:1},8,["href"])])])}),128)),((g=u.tableRentals)==null?void 0:g.total)===0?(p(),D("tr",Ie,[...a[9]||(a[9]=[o("td",{class:"px-6 py-4 border-t text-center",colspan:"7"},"No records found.",-1)])])):P("",!0)]}),_:1},8,["data"])]),o("div",Ne,[s(e.Pagination,{links:(y=u.tableRentals)==null?void 0:y.links},null,8,["links"])]),s(e.ConfirmationModal,{show:e.isPayment,onClose:e.cancelPayment},{title:i(()=>[...a[10]||(a[10]=[S(" Pay Now ",-1)])]),content:i(()=>{var n,g,t,T,h,x,v,_;return[o("div",be,[a[11]||(a[11]=o("p",{class:"text-gray-600"},"Please complete your payment below:",-1)),a[12]||(a[12]=o("iframe",{src:"https://www.lbp-eservices.com/egps/portal/Fields.jsp",class:"w-full h-96 border rounded-md"},null,-1)),o("div",ze,[o("div",Ve,[s(e.InputLabel,{for:"receipt",value:"Receipt",class:"mb-1 block w-full"}),s(e.SingleFileUpload,{modelValue:e.formData.receipt,"onUpdate:modelValue":a[2]||(a[2]=m=>e.formData.receipt=m),label:"Upload Official Receipt",accept:".jpg,.jpeg,.png,.pdf",class:"mt-1 block w-full",error:(g=(n=e.formData)==null?void 0:n.errors)==null?void 0:g.receipt},null,8,["modelValue","error"]),s(e.InputError,{class:"mt-2",message:(T=(t=e.formData)==null?void 0:t.errors)==null?void 0:T.receipt},null,8,["message"])])]),o("div",Fe,[o("div",Re,[s(e.InputLabel,{for:"amount",value:"Amount"}),s(e.TextInput,{id:"amount",modelValue:e.formData.amount,"onUpdate:modelValue":a[3]||(a[3]=m=>e.formData.amount=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"amount"},null,8,["modelValue"]),s(e.InputError,{class:"mt-2",message:(x=(h=e.formData)==null?void 0:h.errors)==null?void 0:x.amount},null,8,["message"])]),o("div",Be,[s(e.InputLabel,{for:"reference_number",value:"Reference Number"}),s(e.TextInput,{id:"reference_number",modelValue:e.formData.reference_number,"onUpdate:modelValue":a[4]||(a[4]=m=>e.formData.reference_number=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"reference_number"},null,8,["modelValue"]),s(e.InputError,{class:"mt-2",message:(_=(v=e.formData)==null?void 0:v.errors)==null?void 0:_.reference_number},null,8,["message"])])])])]}),footer:i(()=>[o("div",Ae,[s(e.SecondaryButton,{onClick:e.cancelPayment},{default:i(()=>[...a[13]||(a[13]=[S(" Cancel ",-1)])]),_:1}),o("form",{onSubmit:G(e.submit,["prevent"])},[s(e.LoadingButton,{loading:e.form.processing,class:"bg-primary ml-auto",type:"submit"},{default:i(()=>[...a[14]||(a[14]=[S(" Submit ",-1)])]),_:1},8,["loading"])],32)])]),default:i(()=>[a[15]||(a[15]=o("div",null,null,-1))]),_:1},8,["show"])]}),_:1})}const rt=ie(me,[["render",Le],["__file","TableRental.vue"]]);export{rt as default};
