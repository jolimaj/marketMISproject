import{d as a,o as t,a as l,b as s,p as N,w as r,f as c,n as C,t as x,U as K,g as f,h as A,C as B,c as _,e as m,F as O,r as U,E,x as I,G as R,i as V,Q as k}from"./app-uXddmEpz.js";import{D as Y,A as j}from"./DialogModal-CEquPEd4.js";import{I as M}from"./InputError-ttZ3AOSc.js";import{P as D}from"./PrimaryButton-Q75du8kc.js";import{S as L}from"./SecondaryButton-CtFZuys_.js";import{T as q}from"./TextInput-CHlK30DQ.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{D as G}from"./DangerButton-CQleH8u-.js";import{I as z}from"./InputLabel-D_8-PT0K.js";import"./SectionTitle-4XE_3y5m.js";import"./Modal-uTiD3aIt.js";const W={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(h,{expose:e,emit:u}){e();const o=u,d=f(!1),n=A({password:"",error:"",processing:!1}),i=f(null),v=()=>{axios.get(route("password.confirmation")).then(y=>{y.data.confirmed?o("confirmed"):(d.value=!0,setTimeout(()=>i.value.focus(),250))})},b=()=>{n.processing=!0,axios.post(route("password.confirm"),{password:n.password}).then(()=>{n.processing=!1,p(),B().then(()=>o("confirmed"))}).catch(y=>{n.processing=!1,n.error=y.response.data.errors.password[0],i.value.focus()})},p=()=>{d.value=!1,n.password="",n.error=""},w={emit:o,confirmingPassword:d,form:n,passwordInput:i,startConfirmingPassword:v,confirmPassword:b,closeModal:p,ref:f,reactive:A,nextTick:B,DialogModal:Y,InputError:M,PrimaryButton:D,SecondaryButton:L,TextInput:q};return Object.defineProperty(w,"__isScriptSetup",{enumerable:!1,value:!0}),w}},J={class:"mt-4"};function X(h,e,u,o,d,n){return t(),a("span",null,[l("span",{onClick:o.startConfirmingPassword},[N(h.$slots,"default")]),s(o.DialogModal,{show:o.confirmingPassword,onClose:o.closeModal},{title:r(()=>[c(x(u.title),1)]),content:r(()=>[c(x(u.content)+" ",1),l("div",J,[s(o.TextInput,{ref:"passwordInput",modelValue:o.form.password,"onUpdate:modelValue":e[0]||(e[0]=i=>o.form.password=i),type:"password",class:"mt-1 block w-3/4",placeholder:"Password",autocomplete:"current-password",onKeyup:K(o.confirmPassword,["enter"])},null,8,["modelValue"]),s(o.InputError,{message:o.form.error,class:"mt-2"},null,8,["message"])])]),footer:r(()=>[s(o.SecondaryButton,{onClick:o.closeModal},{default:r(()=>e[1]||(e[1]=[c(" Cancel ")])),_:1,__:[1]}),s(o.PrimaryButton,{class:C(["ms-3",{"opacity-25":o.form.processing}]),disabled:o.form.processing,onClick:o.confirmPassword},{default:r(()=>[c(x(u.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])])}const Z=Q(W,[["render",X],["__file","ConfirmsPassword.vue"]]),$={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(h,{expose:e}){e();const u=h,o=E(),d=f(!1),n=f(!1),i=f(!1),v=f(null),b=f(null),p=f([]),w=I({code:""}),y=R(()=>{var g;return!d.value&&((g=o.props.auth.user)==null?void 0:g.two_factor_enabled)});V(y,()=>{y.value||(w.reset(),w.clearErrors())});const H=()=>{d.value=!0,k.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([T(),S(),F()]),onFinish:()=>{d.value=!1,n.value=u.requiresConfirmation}})},T=()=>axios.get(route("two-factor.qr-code")).then(g=>{v.value=g.data.svg}),S=()=>axios.get(route("two-factor.secret-key")).then(g=>{b.value=g.data.secretKey}),F=()=>axios.get(route("two-factor.recovery-codes")).then(g=>{p.value=g.data}),P={props:u,page:o,enabling:d,confirming:n,disabling:i,qrCode:v,setupKey:b,recoveryCodes:p,confirmationForm:w,twoFactorEnabled:y,enableTwoFactorAuthentication:H,showQrCode:T,showSetupKey:S,showRecoveryCodes:F,confirmTwoFactorAuthentication:()=>{w.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{n.value=!1,v.value=null,b.value=null}})},regenerateRecoveryCodes:()=>{axios.post(route("two-factor.recovery-codes")).then(()=>F())},disableTwoFactorAuthentication:()=>{i.value=!0,k.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{i.value=!1,n.value=!1}})},ref:f,computed:R,watch:V,get router(){return k},get useForm(){return I},get usePage(){return E},ActionSection:j,ConfirmsPassword:Z,DangerButton:G,InputError:M,InputLabel:z,PrimaryButton:D,SecondaryButton:L,TextInput:q};return Object.defineProperty(P,"__isScriptSetup",{enumerable:!1,value:!0}),P}},oo={key:0,class:"text-lg font-medium text-gray-900"},eo={key:1,class:"text-lg font-medium text-gray-900"},to={key:2,class:"text-lg font-medium text-gray-900"},ro={key:3},no={key:0},ao={class:"mt-4 max-w-xl text-sm text-gray-600"},so={key:0,class:"font-semibold"},io={key:1},co=["innerHTML"],lo={key:0,class:"mt-4 max-w-xl text-sm text-gray-600"},mo={class:"font-semibold"},fo=["innerHTML"],uo={key:1,class:"mt-4"},go={key:1},wo={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg"},yo={class:"mt-5"},_o={key:0},ho={key:1};function vo(h,e,u,o,d,n){return t(),_(o.ActionSection,null,{title:r(()=>e[1]||(e[1]=[c(" Two Factor Authentication ")])),description:r(()=>e[2]||(e[2]=[c(" Add additional security to your account using two factor authentication. ")])),content:r(()=>[o.twoFactorEnabled&&!o.confirming?(t(),a("h3",oo," You have enabled two factor authentication. ")):o.twoFactorEnabled&&o.confirming?(t(),a("h3",eo," Finish enabling two factor authentication. ")):(t(),a("h3",to," You have not enabled two factor authentication. ")),e[11]||(e[11]=l("div",{class:"mt-3 max-w-xl text-sm text-gray-600"},[l("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),o.twoFactorEnabled?(t(),a("div",ro,[o.qrCode?(t(),a("div",no,[l("div",ao,[o.confirming?(t(),a("p",so," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(t(),a("p",io," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),l("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:o.qrCode},null,8,co),o.setupKey?(t(),a("div",lo,[l("p",mo,[e[3]||(e[3]=c(" Setup Key: ")),l("span",{innerHTML:o.setupKey},null,8,fo)])])):m("",!0),o.confirming?(t(),a("div",uo,[s(o.InputLabel,{for:"code",value:"Code"}),s(o.TextInput,{id:"code",modelValue:o.confirmationForm.code,"onUpdate:modelValue":e[0]||(e[0]=i=>o.confirmationForm.code=i),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:K(o.confirmTwoFactorAuthentication,["enter"])},null,8,["modelValue"]),s(o.InputError,{message:o.confirmationForm.errors.code,class:"mt-2"},null,8,["message"])])):m("",!0)])):m("",!0),o.recoveryCodes.length>0&&!o.confirming?(t(),a("div",go,[e[4]||(e[4]=l("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[l("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),l("div",wo,[(t(!0),a(O,null,U(o.recoveryCodes,i=>(t(),a("div",{key:i},x(i),1))),128))])])):m("",!0)])):m("",!0),l("div",yo,[o.twoFactorEnabled?(t(),a("div",ho,[s(o.ConfirmsPassword,{onConfirmed:o.confirmTwoFactorAuthentication},{default:r(()=>[o.confirming?(t(),_(o.PrimaryButton,{key:0,type:"button",class:C(["me-3",{"opacity-25":o.enabling||o.confirmationForm.processing}]),disabled:o.enabling||o.confirmationForm.processing},{default:r(()=>e[6]||(e[6]=[c(" Confirm ")])),_:1,__:[6]},8,["class","disabled"])):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.regenerateRecoveryCodes},{default:r(()=>[o.recoveryCodes.length>0&&!o.confirming?(t(),_(o.SecondaryButton,{key:0,class:"me-3"},{default:r(()=>e[7]||(e[7]=[c(" Regenerate Recovery Codes ")])),_:1,__:[7]})):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.showRecoveryCodes},{default:r(()=>[o.recoveryCodes.length===0&&!o.confirming?(t(),_(o.SecondaryButton,{key:0,class:"me-3"},{default:r(()=>e[8]||(e[8]=[c(" Show Recovery Codes ")])),_:1,__:[8]})):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.disableTwoFactorAuthentication},{default:r(()=>[o.confirming?(t(),_(o.SecondaryButton,{key:0,class:C({"opacity-25":o.disabling}),disabled:o.disabling},{default:r(()=>e[9]||(e[9]=[c(" Cancel ")])),_:1,__:[9]},8,["class","disabled"])):m("",!0)]),_:1}),s(o.ConfirmsPassword,{onConfirmed:o.disableTwoFactorAuthentication},{default:r(()=>[o.confirming?m("",!0):(t(),_(o.DangerButton,{key:0,class:C({"opacity-25":o.disabling}),disabled:o.disabling},{default:r(()=>e[10]||(e[10]=[c(" Disable ")])),_:1,__:[10]},8,["class","disabled"]))]),_:1})])):(t(),a("div",_o,[s(o.ConfirmsPassword,{onConfirmed:o.enableTwoFactorAuthentication},{default:r(()=>[s(o.PrimaryButton,{type:"button",class:C({"opacity-25":o.enabling}),disabled:o.enabling},{default:r(()=>e[5]||(e[5]=[c(" Enable ")])),_:1,__:[5]},8,["class","disabled"])]),_:1})]))])]),_:1})}const Vo=Q($,[["render",vo],["__file","TwoFactorAuthenticationForm.vue"]]);export{Vo as default};
