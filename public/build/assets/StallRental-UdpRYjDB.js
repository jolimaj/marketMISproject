import{j as me,c as M,o as n,w as x,a as e,b as i,e as k,k as re,d,F as z,r as A,t as a,v as xe,n as ae,f as D,l as le,m as ue,g as P,h as oe,x as ne,i as ie,Q as de}from"./app-BkL1CNwx.js";import{f as fe,a as pe,b as ye,c as ge}from"./helper-Jpd2WSUx.js";import{l as I,p as ce}from"./pickBy-DBz4G69m.js";import{A as he}from"./AppLayout-BPPdX9d-.js";import{B as we}from"./BaseTable-COYnGHVO.js";import{P as _e}from"./Pagination-DySzg0s6.js";import{S as ve}from"./SearchFilter-BYGHE1w8.js";import{B as ke}from"./Badge-km_yutmJ.js";import{I as De}from"./Icons-DwfuqtxP.js";import{D as je}from"./Drawer-Bd1JPLm3.js";import{C as Ce}from"./ConfirmationModal-DaMdbgjb.js";import{D as Se}from"./DangerButton-LWdATqaO.js";import{S as Be}from"./SecondaryButton-CBHJF43I.js";import{F as be}from"./FlashMessage-BQau8JjT.js";import{_ as Re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logo-DeUXyAzp.js";import"./Footer-DHOCUsg6.js";import"./Modal-CpcotBMD.js";const ze={__name:"StallRental",props:{stallsCategories:Object,stallRentals:Object,filters:Object,auth:Object},setup(j,{expose:s}){var w,_,y;s();const C=["Rental No.","Vendor","Business Name","Stall","Duration","Type","Quarterly Payment","Due Date","Penalty","Current Payment","Status",""],t=P(!1),p=P({}),V=P(!1),m=j,u=oe({search:(w=m==null?void 0:m.filters)==null?void 0:w.search,category:(_=m==null?void 0:m.filters)==null?void 0:_.category,status:(y=m==null?void 0:m.filters)==null?void 0:y.status}),g=ne({remarks:""});ie(u,I.throttle(()=>{var c;de.get(((c=m.auth.user)==null?void 0:c.role_id)===1?"/admin/rental-management/stall-leasing":"/department/rental-management/stall-leasing",ce(u),{preserveState:!0})},150),{deep:!0});function o(){u.search="",u.category=null,Object.assign(u,I.mapValues(u,()=>null))}function f(c){p.value=c,t.value=!0}const h={headers:C,showDrawer:t,drawerData:p,isRejected:V,props:m,form:u,forms:g,reset:o,getDetails:f,status:c=>{let v={color:"blue",status:"Vacant"};switch(c){case 3:v={color:"orange",status:"Expired"};break;case 2:v={color:"red",status:"Rejected"};break;case 1:v={color:"green",status:"Approved"};break;default:v={color:"blue",status:"Pending"}}return v},closeRejection:()=>{V.value=!1,t.value=!0},rejectPermits:()=>{t.value=!1,V.value=!0},approveConfirm:()=>{var c;delete g.remarks,g.put(route("department.applications.stalls.approve",(c=p==null?void 0:p.value)==null?void 0:c.id)),t.value=!1},rejectConfirm:()=>{var c;console.log("ss"),g.put(route("department.applications.stalls.reject",(c=p==null?void 0:p.value)==null?void 0:c.id),{onSuccess:()=>{g.reset(),t.value=!1}})},watch:ie,reactive:oe,ref:P,get formatAmount(){return ge},get formatDate(){return ye},get formatDateShort(){return pe},get fullName(){return fe},get router(){return de},get useForm(){return ne},get throttle(){return I.throttle},get mapValues(){return I.mapValues},get pickBy(){return ce},AppLayout:he,BaseTable:we,Pagination:_e,SearchFilter:ve,Badge:ke,Icons:De,Drawer:je,ConfirmationModal:Ce,DangerButton:Se,SecondaryButton:Be,FlashMessage:be};return Object.defineProperty(h,"__isScriptSetup",{enumerable:!1,value:!0}),h}},Ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},Ve={class:"flex items-center justify-between mb-6"},Ne=["value"],Pe={class:"px-4 py-3 capitalize text-center"},Ie={class:"px-4 py-3 capitalize text-center"},Me={class:"px-4 py-3 capitalize text-center"},Fe={class:"px-4 py-3 capitalize text-center"},Le={class:"px-4 py-3 capitalize text-center"},qe={class:"px-4 py-3 capitalize text-center"},Oe={class:"px-4 py-3 capitalize text-center"},Ee={class:"px-4 py-3 capitalize text-center"},Te={class:"px-4 py-3 capitalize text-center"},Ue={class:"px-4 py-3 capitalize text-center"},Qe={class:"px-4 py-3 capitalize text-center"},Je={key:0,class:"w-px border-t"},Xe={key:0},Ge={class:"mt-6 flex justify-center"},He={key:0},Ke={class:"ml-auto w-full max-w-xl bg-white shadow-lg h-full overflow-y-auto"},We={class:"p-4 border rounded-xl mb-4 bg-gray-50 flex justify-between items-center"},Ye={class:"flex items-center space-x-3"},Ze={class:"font-semibold text-primary"},$e={class:"flex items-center text-xs text-gray-500 space-x-2"},et={key:0,class:"flex space-x-2"},tt={class:"p-4 border rounded-xl mb-5"},st={class:"space-y-2 text-sm"},rt={class:"flex items-center space-x-2"},at={class:"text-gray-600"},lt={class:"flex items-center space-x-2"},ot={class:"text-gray-600"},nt={class:"flex items-center space-x-2"},it={class:"text-gray-600"},dt={class:"flex items-center space-x-2"},ct={class:"text-gray-600"},mt={class:"flex items-center space-x-2"},xt={class:"text-gray-600"},ut={class:"p-4 border rounded-xl mb-5"},ft={class:"space-y-2 text-sm"},pt={class:"flex items-center space-x-2"},yt={class:"text-gray-600"},gt={class:"flex items-center space-x-2"},ht={class:"text-gray-600"},wt={class:"flex items-center space-x-2"},_t={class:"text-gray-600"},vt={class:"flex items-center space-x-2"},kt={class:"text-gray-600"},Dt={class:"p-4 border rounded-xl mb-5"},jt={class:"space-y-2 text-sm"},Ct={class:"flex items-center space-x-2"},St={class:"text-gray-600 text-sm"},Bt={class:"flex items-center px-2 py-1 text-blue-600 hover:text-blue-800 text-sm"},bt=["href"],Rt={class:"p-4 border rounded-xl mb-5"},zt={class:"space-y-2 text-sm"},At={class:"flex items-center space-x-2"},Vt={class:"space-y-2"},Nt={class:"flex items-center space-x-2"},Pt={class:"text-secondary"},It={class:"text-gray-600"},Mt={class:"flex items-center space-x-2"},Ft={class:"text-gray-600"},Lt={key:0,class:"p-4 border rounded-xl"},qt={class:"space-y-2 text-sm"},Ot={class:"flex items-center space-x-2"},Et={class:"space-y-2"},Tt={class:"flex items-center space-x-2"},Ut={class:"text-secondary"},Qt={class:"text-gray-600"},Jt={class:"space-y-4 p-4"},Xt={class:"flex justify-end space-x-3 p-4"};function Gt(j,s,C,t,p,V){const m=me("InputError");return n(),M(t.AppLayout,{title:"Stalls"},{header:x(()=>[...s[4]||(s[4]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Stalls ",-1)])]),default:x(()=>{var u,g;return[s[34]||(s[34]=e("h1",{class:"mb-8 text-3xl font-bold text-primary"},"Stall Leasing",-1)),e("div",Ae,[j.$page.props.flash.success?(n(),M(t.FlashMessage,{key:0,message:j.$page.props.flash.success,type:"success"},null,8,["message"])):k("",!0),j.$page.props.flash.error?(n(),M(t.FlashMessage,{key:1,message:j.$page.props.flash.error,type:"error"},null,8,["message"])):k("",!0),e("div",Ve,[i(t.SearchFilter,{modelValue:t.form.search,"onUpdate:modelValue":s[1]||(s[1]=o=>t.form.search=o),class:"mr-4 w-full max-w-md",onReset:t.reset},{default:x(()=>[s[6]||(s[6]=e("label",{class:"block text-gray-700"},"Stall Category:",-1)),re(e("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>t.form.status=o),class:"form-select mt-1 w-full"},[s[5]||(s[5]=e("option",{value:null},"All",-1)),(n(!0),d(z,null,A(C.stallsCategories,o=>(n(),d("option",{key:o.id,value:o.id},a(o.name),9,Ne))),128))],512),[[xe,t.form.status]])]),_:1},8,["modelValue"])]),i(t.BaseTable,{headers:t.headers,data:(u=C.stallRentals)==null?void 0:u.data,class:ae("center")},{row:x(({data:o})=>{var f;return[(n(!0),d(z,null,A(o,(r,N)=>{var S,B,b,h,w,_;return n(),d("tr",{key:C.stallRentals.id,class:"hover:bg-gray-50"},[e("td",Pe,a((S=r==null?void 0:r.permits)!=null&&S.permit_number?`${(B=r==null?void 0:r.permits)==null?void 0:B.permit_number}`:"-"),1),e("td",Ie,a(`${t.fullName(r==null?void 0:r.vendor)}`),1),e("td",Me,a(r.name),1),e("td",Fe,a((b=r==null?void 0:r.stalls)==null?void 0:b.name),1),e("td",Le,a(r!=null&&r.start_date&&(r!=null&&r.end_date)?`${t.formatDate(r.start_date)} - ${t.formatDate(r.end_date)}`:"-"),1),e("td",qe,[i(t.Badge,{color:((h=r==null?void 0:r.permits)==null?void 0:h.type)==="new"?"green":"blue"},{default:x(()=>{var y;return[D(a((y=r==null?void 0:r.permits)==null?void 0:y.type),1)]}),_:2},1032,["color"])]),e("td",Oe,a(t.formatAmount(r==null?void 0:r.quarterly_payment)),1),e("td",Ee,a(t.formatDate(new Date(r==null?void 0:r.next_payment_due))),1),e("td",Te,a(t.formatAmount(r==null?void 0:r.penalty)),1),e("td",Ue,[e("p",{class:ae(["font-semibold",(r==null?void 0:r.current_payment)==="Paid"?"text-green-600":"text-red-600"])},a(r==null?void 0:r.current_payment),3)]),e("td",Qe,[i(t.Badge,{color:t.status(r.permits.status).color},{default:x(()=>[D(a(t.status(r.permits.status).status),1)]),_:2},1032,["color"])]),((_=(w=t.props)==null?void 0:w.filters)==null?void 0:_.role)!=="user"?(n(),d("td",Je,[i(t.Icons,{name:"cheveron-right",onClick:y=>t.getDetails(r),class:"block w-6 h-6 fill-primary"},null,8,["onClick"])])):k("",!0)])}),128)),((f=C.stallRentals)==null?void 0:f.total)===0?(n(),d("tr",Xe,[...s[7]||(s[7]=[e("td",{class:"px-6 py-4 border-t text-center",colspan:"12"},"No records found.",-1)])])):k("",!0)]}),_:1},8,["data"])]),e("div",Ge,[i(t.Pagination,{links:(g=C.stallRentals)==null?void 0:g.links},null,8,["links"])]),i(t.Drawer,{modelValue:t.showDrawer,"onUpdate:modelValue":s[2]||(s[2]=o=>t.showDrawer=o),title:"Application Details",data:t.drawerData.value},{default:x(()=>{var o,f,r,N,S,B,b,h,w,_,y,c,v,F,L,q,O,E,T,U,Q,J,X,G,H,K,W,Y,Z,$,ee;return[t.drawerData?(n(),d("div",He,[e("div",Ke,[e("div",We,[e("div",Ye,[i(t.Icons,{name:"stalls",class:"block w-6 h-6 fill-primary"}),e("div",null,[e("p",Ze,a(`Stall Leasing Application (${(f=(o=t.drawerData)==null?void 0:o.permits)==null?void 0:f.type})`),1),e("div",$e,[i(t.Badge,{color:t.status((r=t.drawerData)==null?void 0:r.permits.status).color},{default:x(()=>{var l;return[D(a(t.status((l=t.drawerData)==null?void 0:l.permits.status).status),1)]}),_:1},8,["color"]),e("span",null,a(`â€¢ Applied ${t.formatDateShort(t.drawerData.permits.created_at)}`),1)])])]),((N=j.$page.props.auth.user)==null?void 0:N.role_id)===2?(n(),d("div",et,[e("button",{class:"flex items-center px-3 py-1.5 text-white bg-red-600 rounded-lg hover:bg-red-700 text-sm",onClick:t.rejectPermits},[...s[8]||(s[8]=[e("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),D(" Reject ",-1)])]),e("form",{onSubmit:le(t.approveConfirm,["prevent"])},[...s[9]||(s[9]=[e("button",{class:"flex items-center px-3 py-1.5 text-white bg-green-600 rounded-lg hover:bg-green-700 text-sm"},[e("svg",{class:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})]),D(" Approve ")],-1)])],32)])):k("",!0)]),e("div",tt,[s[20]||(s[20]=e("h3",{class:"text-md font-semibold mb-3 text-primary"},"Vendor Information",-1)),e("ul",st,[e("li",rt,[s[11]||(s[11]=e("svg",{class:"w-4 h-4 text-secondary font-bold",fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:"64",height:"64",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[e("circle",{cx:"32",cy:"20",r:"8"}),e("path",{d:"M16 52c0-8 8-14 16-14s16 6 16 14"})],-1)),e("span",null,[s[10]||(s[10]=e("strong",{class:"text-secondary"},"Full Name: ",-1)),e("span",at,a(`${t.fullName((S=t.drawerData)==null?void 0:S.vendor)}`),1)])]),e("li",lt,[s[13]||(s[13]=e("svg",{class:"w-4 h-4 text-secondary",fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:"64",height:"64",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[e("rect",{x:"10",y:"16",width:"44",height:"32",rx:"4",ry:"4"}),e("polyline",{points:"10,16 32,36 54,16"})],-1)),e("span",null,[s[12]||(s[12]=e("strong",{class:"text-secondary"},"Email Address: ",-1)),e("span",ot,a((b=(B=t.drawerData)==null?void 0:B.vendor)==null?void 0:b.email),1)])]),e("li",nt,[s[15]||(s[15]=e("svg",{class:"w-4 h-4 text-secondary",fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:"64",height:"64",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[e("rect",{x:"20",y:"8",width:"24",height:"48",rx:"4",ry:"4"}),e("circle",{cx:"32",cy:"50",r:"2"})],-1)),e("span",null,[s[14]||(s[14]=e("strong",{class:"text-secondary"},"Phone Number: ",-1)),e("span",it,a((w=(h=t.drawerData)==null?void 0:h.vendor)==null?void 0:w.mobile),1)])]),e("li",dt,[s[17]||(s[17]=e("svg",{class:"w-4 h-4 text-secondary",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:"64",height:"64",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[e("path",{d:"M32 8c-8 0-14 6-14 14 0 10 14 26 14 26s14-16 14-26c0-8-6-14-14-14z"}),e("circle",{cx:"32",cy:"22",r:"4"})],-1)),e("span",null,[s[16]||(s[16]=e("strong",{class:"text-secondary"},"Address: ",-1)),e("span",ct,a((y=(_=t.drawerData)==null?void 0:_.vendor)==null?void 0:y.address),1)])]),e("li",mt,[s[19]||(s[19]=e("svg",{class:"w-4 h-4 text-secondary",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",width:"64",height:"64",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[e("rect",{x:"10",y:"14",width:"44",height:"40",rx:"4",ry:"4"}),e("line",{x1:"10",y1:"24",x2:"54",y2:"24"}),e("line",{x1:"22",y1:"8",x2:"22",y2:"20"}),e("line",{x1:"42",y1:"8",x2:"42",y2:"20"}),e("circle",{cx:"32",cy:"38",r:"4"})],-1)),e("span",null,[s[18]||(s[18]=e("strong",{class:"text-secondary"},"Birthday: ",-1)),e("span",xt,a(t.formatDateShort((v=(c=t.drawerData)==null?void 0:c.vendor)==null?void 0:v.birthday)),1)])])])]),e("div",ut,[s[25]||(s[25]=e("h3",{class:"text-md font-semibold mb-3 text-primary"},"Business Information",-1)),e("ul",ft,[e("li",pt,[i(t.Icons,{name:"business-names",class:"w-4 h-4 text-secondary"}),e("span",null,[s[21]||(s[21]=e("strong",{class:"text-secondary"},"Business Name: ",-1)),e("span",yt,a((F=t.drawerData)==null?void 0:F.name),1)])]),e("li",gt,[i(t.Icons,{name:"stall-names",class:"w-4 h-4 text-secondary"}),e("span",null,[s[22]||(s[22]=e("strong",{class:"text-secondary"},"Stall Name: ",-1)),e("span",ht,a((q=(L=t.drawerData)==null?void 0:L.stalls)==null?void 0:q.name),1)])]),e("li",wt,[i(t.Icons,{name:"business-category",class:"w-4 h-4 text-secondary"}),e("span",null,[s[23]||(s[23]=e("strong",{class:"text-secondary"},"Category: ",-1)),e("span",_t,a((T=(E=(O=t.drawerData)==null?void 0:O.stalls)==null?void 0:E.stallsCategories)==null?void 0:T.name),1)])]),e("li",vt,[i(t.Icons,{name:"business-size",class:"w-4 h-4 text-secondary"}),e("span",null,[s[24]||(s[24]=e("strong",{class:"text-secondary"},"Stall Size: ",-1)),e("span",kt,a((Q=(U=t.drawerData)==null?void 0:U.stalls)!=null&&Q.size?`${(X=JSON.parse((J=t.drawerData)==null?void 0:J.stalls.size))==null?void 0:X.length} X ${(H=JSON.parse((G=t.drawerData)==null?void 0:G.stalls.size))==null?void 0:H.width}`:"-"),1)])])])]),e("div",Dt,[s[26]||(s[26]=e("h3",{class:"text-sm font-semibold mb-3 text-primary"},"Requirements Submitted",-1)),e("ul",jt,[(n(!0),d(z,null,A(t.drawerData.requirements,(l,R)=>(n(),d("li",{key:R,class:"flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg shadow-sm"},[e("div",Ct,[i(t.Icons,{name:"requirements",class:"block w-6 h-6 fill-primary"}),e("span",St,a(l.name),1)]),e("button",Bt,[l.url?(n(),d("a",{key:0,href:`${l.url}/${l.attachment}`,class:"text-blue-600 ml-2 hover:underline",target:"_blank"}," [View] ",8,bt)):k("",!0)])]))),128))])]),e("div",Rt,[s[28]||(s[28]=e("h3",{class:"text-md font-semibold mb-3 text-primary"},"Payments",-1)),e("ul",zt,[e("li",At,[e("ul",Vt,[(n(!0),d(z,null,A((W=(K=t.drawerData)==null?void 0:K.paymentDetails)==null?void 0:W.breakdown,(l,R)=>(n(),d("li",{key:R,class:"flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg shadow-sm"},[e("div",Nt,[e("span",null,[e("strong",Pt,a(`â€¢ ${l==null?void 0:l.type}: `),1),e("span",It,a(t.formatAmount(l==null?void 0:l.amount)),1)])])]))),128))])]),e("li",Mt,[e("span",null,[s[27]||(s[27]=e("strong",{class:"text-secondary"},"Total: ",-1)),e("span",Ft,a(t.formatAmount((Y=t.drawerData)==null?void 0:Y.quarterly_payment)),1)])])])]),(($=(Z=t.drawerData)==null?void 0:Z.approvals)==null?void 0:$.length)>0?(n(),d("div",Lt,[s[29]||(s[29]=e("h3",{class:"text-md font-semibold mb-3 text-primary"},"Approvals",-1)),e("ul",qt,[e("li",Ot,[e("ul",Et,[(n(!0),d(z,null,A((ee=t.drawerData)==null?void 0:ee.approvals,(l,R)=>{var te,se;return n(),d("li",{key:R,class:"flex justify-between items-center bg-gray-50 px-3 py-2 rounded-lg shadow-sm"},[e("div",Tt,[e("span",null,[e("strong",Ut,a(`${l==null?void 0:l.department}: `),1),e("span",Qt,a(`${(te=l==null?void 0:l.approver)==null?void 0:te.name}(${(se=l==null?void 0:l.approver)==null?void 0:se.position})`),1)])])])}),128))])])])])):k("",!0)])])):k("",!0)]}),_:1},8,["modelValue","data"]),i(t.ConfirmationModal,{show:t.isRejected,onClose:t.closeRejection},{title:x(()=>[...s[30]||(s[30]=[D(" Reject Request ",-1)])]),content:x(()=>{var o,f;return[e("div",Jt,[s[31]||(s[31]=e("p",{class:"text-gray-700 text-sm md:text-base"}," Are you sure you would like to reject this request? Please provide a reason below: ",-1)),e("div",null,[re(e("textarea",{id:"remarks","onUpdate:modelValue":s[3]||(s[3]=r=>t.forms.remarks=r),rows:"3",required:"",placeholder:"Enter your reason for rejection...",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 sm:text-sm resize-none"},null,512),[[ue,t.forms.remarks]]),i(m,{class:"mt-2",message:(f=(o=t.form)==null?void 0:o.errors)==null?void 0:f.remarks},null,8,["message"])])])]}),footer:x(()=>[e("div",Xt,[i(t.SecondaryButton,{onClick:t.closeRejection},{default:x(()=>[...s[32]||(s[32]=[D(" Cancel ",-1)])]),_:1}),e("form",{onSubmit:le(t.rejectConfirm,["prevent"])},[i(t.DangerButton,{disabled:!t.forms.remarks,onClick:t.rejectConfirm,class:"disabled:opacity-50"},{default:x(()=>[...s[33]||(s[33]=[D(" Reject ",-1)])]),_:1},8,["disabled"])],32)])]),_:1},8,["show"])]}),_:1})}const xs=Re(ze,[["render",Gt],["__file","StallRental.vue"]]);export{xs as default};
