import{c as z,o as p,w as n,a as l,b as s,e as I,m as H,d as k,F as R,r as A,t as c,v as K,n as L,f as S,p as Q,g as V,h as j,u as C,i as M,j as E,l as X}from"./app-BhO9iOqB.js";import{l as U,p as O}from"./pickBy-CyuxResV.js";import{S as J,a as q,E as Y}from"./SingleFileUpload-V4WlRUNr.js";import{A as W}from"./AppLayout-BpKM9RIr.js";import{B as Z}from"./BaseTable-CLeyjo4S.js";import{P as b}from"./Pagination-5HhtTOcU.js";import{I as $}from"./Icons-Dvc8NfnG.js";import{f as G,b as ee,c as F}from"./helper-ugt-wfEi.js";import{B as te}from"./Badge-DrS_MY2x.js";import{F as ae}from"./FlashMessage-xb46_0no.js";import{S as le}from"./SearchFilter-CMburh6-.js";import{C as oe}from"./ConfirmationModal-CPlnIf8t.js";import{S as re}from"./SecondaryButton-E4WG1o2b.js";import{I as se}from"./InputLabel-2QwAf0Pu.js";import{T as ie}from"./TextInput-c8i1V4q1.js";import{I as ne}from"./InputError-CHjSaXQ9.js";import{L as me}from"./LoadingButton-CH1Va9kl.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Logo-DnMCTrVo.js";import"./Footer-DpwF8PlI.js";import"./Modal-d_x2f9es.js";const de={__name:"StallRental",props:{stallRentals:Object,filters:Object},setup(w,{expose:a}){var m,P;a();const u=V(!1),e=V(null),T=["Rental No.","Vendor","Business Name","Stall","Duration","Type","Quarterly Payment","Due Date","Penalty","Current Payment","Status",""],f=w,d=j({search:(m=f==null?void 0:f.filters)==null?void 0:m.search,type:(P=f==null?void 0:f.filters)==null?void 0:P.type}),y=C({receipt:null,reference_number:"",amount:0,stall_rental_id:null});M(d,U.throttle(()=>{E.get("/my-rentals/stall-leasing",O(d),{preserveState:!0})},150),{deep:!0});const i=r=>{let o={color:"blue",status:"Vacant"};switch(r){case 3:o={color:"orange",status:"Expired"};break;case 2:o={color:"red",status:"Rejected"};break;case 1:o={color:"green",status:"Approved"};break;default:o={color:"blue",status:"Pending"}}return o},_=[{id:1,name:"New"},{id:2,name:"Renewal"}];function t(){d.search="",d.type=null,Object.assign(d,mapValues(d,()=>null))}function D(){u.value=!1}function h(r){e.value=r,y.amount=r==null?void 0:r.quarterly_payment,y.stall_rental_id=Number(r==null?void 0:r.id),u.value=!0}const g=r=>{const o=new Y;o.setFontSize(18),o.text("MARKETMIS - Payment Invoice",14,20),o.setFontSize(12),o.text(`Invoice Date: ${r.date}`,14,35),o.text(`Transaction ID: ${r.transaction_id}`,14,42),o.text(`Stall Holder: ${r.applicant_name}`,14,49),o.text(`Payment Method: ${r.payment_method}`,14,56),q(o,{startY:70,head:[["Description","Amount"]],body:[["Stall Rental Payment",`${F(r.amount)}`]],theme:"grid"}),o.setFontSize(14),o.text(`Total: ${F(r.amount)}`,150,o.lastAutoTable.finalY+10),o.setFontSize(10),o.text("Thank you for your payment!",14,o.lastAutoTable.finalY+20),o.text("Generated by MarketMIS",14,o.lastAutoTable.finalY+26),o.save(`Invoice-${r.transaction_id}.pdf`)},x={isPayment:u,payee:e,headers:T,props:f,form:d,formData:y,status:i,statusOptions:_,reset:t,cancelPayment:D,payNow:h,generateInvoicePDF:g,submit:()=>{y.post(route("applications.payment"),{onSuccess:()=>{var r;g({applicant_name:G((r=e.value)==null?void 0:r.vendor),transaction_id:`TXN-${Date.now()}`,amount:e.value.quarterly_payment,date:new Date().toLocaleDateString(),payment_method:"Lizbiz Pay"}),y.reset(),u.value=!1}})},watch:M,reactive:j,ref:V,get Link(){return X},get router(){return E},get useForm(){return C},get throttle(){return U.throttle},get pickBy(){return O},get jsPDF(){return Y},get autoTable(){return q},AppLayout:W,BaseTable:Z,Pagination:b,Icon:$,get formatAmount(){return F},get formatDate(){return ee},get fullName(){return G},Badge:te,FlashMessage:ae,SearchFilter:le,ConfirmationModal:oe,SecondaryButton:re,InputLabel:se,TextInput:ie,InputError:ne,SingleFileUpload:J,LoadingButton:me};return Object.defineProperty(x,"__isScriptSetup",{enumerable:!1,value:!0}),x}},ue={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},pe={class:"flex items-center justify-between mb-6"},fe=["value"],ye={class:"px-4 py-3 capitalize text-center"},ge={class:"px-4 py-3 capitalize text-center"},xe={class:"px-4 py-3 capitalize text-center"},_e={class:"px-4 py-3 capitalize text-center"},he={class:"px-4 py-3 capitalize text-center"},we={class:"px-4 py-3 capitalize text-center"},ve={class:"px-4 py-3 capitalize text-center"},ke={class:"px-4 py-3 capitalize text-center"},Se={class:"px-4 py-3 capitalize text-center"},De={class:"px-4 py-3 capitalize text-center"},Pe={key:0,class:"font-semibold text-blue-600"},Ie=["disabled","onClick"],Ne={class:"px-4 py-3 capitalize text-center"},ze={class:"px-4 py-3 capitalize"},Ve={key:0},Fe={class:"mt-6 flex justify-center"},Te={class:"space-y-4 p-4 text-left"},Be={class:"flex flex-col md:flex-row gap-4 mt-5"},Re={class:"w-full"},Ae={class:"flex flex-col md:flex-row gap-4 mt-5"},Le={class:"w-full"},je={class:"w-full"},Ce={class:"flex justify-end space-x-3 p-4"};function Me(w,a,u,e,T,f){return p(),z(e.AppLayout,{title:"Stalls"},{header:n(()=>[...a[5]||(a[5]=[l("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Stall ",-1)])]),default:n(()=>{var d,y;return[a[16]||(a[16]=l("h1",{class:"mb-8 text-3xl font-bold text-primary"},"Stalls Leasing",-1)),l("div",ue,[w.$page.props.flash.success?(p(),z(e.FlashMessage,{key:0,message:w.$page.props.flash.success,type:"success"},null,8,["message"])):I("",!0),w.$page.props.flash.error?(p(),z(e.FlashMessage,{key:1,message:w.$page.props.flash.error,type:"error"},null,8,["message"])):I("",!0),l("div",pe,[s(e.SearchFilter,{modelValue:e.form.search,"onUpdate:modelValue":a[1]||(a[1]=i=>e.form.search=i),class:"mr-4 w-full max-w-md",onReset:e.reset},{default:n(()=>[a[7]||(a[7]=l("label",{class:"block text-gray-700"},"Type:",-1)),H(l("select",{"onUpdate:modelValue":a[0]||(a[0]=i=>e.form.type=i),class:"form-select mt-1 w-full"},[a[6]||(a[6]=l("option",{value:null},"All",-1)),(p(),k(R,null,A(e.statusOptions,i=>l("option",{key:i.id,value:i.id},c(i.name),9,fe)),64))],512),[[K,e.form.type]])]),_:1},8,["modelValue"]),s(e.Link,{type:"submit",class:L([{"opacity-25":e.form.processing},"bg-btn-gradient text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors"]),disabled:e.form.processing,href:"/my-rentals/stall-leasing/create"},{default:n(()=>[...a[8]||(a[8]=[S("Rent New",-1)])]),_:1},8,["class","disabled"])]),s(e.BaseTable,{headers:e.headers,data:(d=u.stallRentals)==null?void 0:d.data,class:L("center text-center sticky right-0 bg-white z-10")},{row:n(({data:i})=>{var _;return[(p(!0),k(R,null,A(i,(t,D)=>{var h,g,v,x,m,P,r,o,B;return p(),k("tr",{key:u.stallRentals.id,class:"hover:bg-gray-50"},[l("td",ye,c((h=t==null?void 0:t.permits)!=null&&h.permit_number?`${(g=t==null?void 0:t.permits)==null?void 0:g.permit_number}`:"-"),1),l("td",ge,c(`${e.fullName(t==null?void 0:t.vendor)}`),1),l("td",xe,c(t.name),1),l("td",_e,c((v=t==null?void 0:t.stalls)==null?void 0:v.name),1),l("td",he,c((x=t==null?void 0:t.permits)!=null&&x.issued_date&&((m=t==null?void 0:t.permits)!=null&&m.expiry_date)?`${e.formatDate((P=t==null?void 0:t.permits)==null?void 0:P.issued_date)} - ${e.formatDate((r=t.permits)==null?void 0:r.expiry_date)}`:"-"),1),l("td",we,[s(e.Badge,{color:((o=t==null?void 0:t.permits)==null?void 0:o.type)==="new"?"green":"blue"},{default:n(()=>{var N;return[S(c((N=t==null?void 0:t.permits)==null?void 0:N.type),1)]}),_:2},1032,["color"])]),l("td",ve,c(e.formatAmount(t==null?void 0:t.quarterly_payment)),1),l("td",ke,c(t!=null&&t.next_payment_due?e.formatDate(new Date(t==null?void 0:t.next_payment_due)):"N/A"),1),l("td",Se,c(e.formatAmount(t==null?void 0:t.penalty)),1),l("td",De,[(t==null?void 0:t.current_payment)==="Paid"?(p(),k("p",Pe,"Paid")):I("",!0),(t==null?void 0:t.current_payment)==="Not Paid"?(p(),k("button",{key:1,disabled:((B=t==null?void 0:t.permits)==null?void 0:B.status)!==1,class:"inline-block bg-blue-600 text-white font-bold uppercase px-5 py-2 rounded focus:outline-none shadow hover:bg-primary-700 transition-colors",onClick:N=>e.payNow(t),tabindex:"-1"}," Pay Now ",8,Ie)):I("",!0)]),l("td",Ne,[s(e.Badge,{color:e.status(t.permits.status).color},{default:n(()=>[S(c(e.status(t.permits.status).status),1)]),_:2},1032,["color"])]),l("td",ze,[s(e.Link,{class:"flex items-center pr-2",href:`/my-rentals/stall-leasing/${t.id}`,tabindex:"-1"},{default:n(()=>[s(e.Icon,{name:"cheveron-right",class:"block w-6 h-6 fill-primary"})]),_:1},8,["href"])])])}),128)),((_=u.stallRentals)==null?void 0:_.total)===0?(p(),k("tr",Ve,[...a[9]||(a[9]=[l("td",{class:"px-6 py-4 border-t text-center",colspan:"7"},"No records found.",-1)])])):I("",!0)]}),_:1},8,["data"])]),l("div",Fe,[s(e.Pagination,{links:(y=u.stallRentals)==null?void 0:y.links},null,8,["links"])]),s(e.ConfirmationModal,{show:e.isPayment,onClose:e.cancelPayment},{title:n(()=>[...a[10]||(a[10]=[S(" Pay Now ",-1)])]),content:n(()=>{var i,_,t,D,h,g,v,x;return[l("div",Te,[a[11]||(a[11]=l("p",{class:"text-gray-600"},"Please complete your payment below:",-1)),a[12]||(a[12]=l("iframe",{src:"https://www.lbp-eservices.com/egps/portal/Fields.jsp",class:"w-full h-96 border rounded-md"},null,-1)),l("div",Be,[l("div",Re,[s(e.InputLabel,{for:"receipt",value:"Receipt",class:"mb-1 block w-full"}),s(e.SingleFileUpload,{modelValue:e.formData.receipt,"onUpdate:modelValue":a[2]||(a[2]=m=>e.formData.receipt=m),label:"Upload Official Receipt",accept:".jpg,.jpeg,.png,.pdf",class:"mt-1 block w-full",error:(_=(i=e.formData)==null?void 0:i.errors)==null?void 0:_.receipt},null,8,["modelValue","error"]),s(e.InputError,{class:"mt-2",message:(D=(t=e.formData)==null?void 0:t.errors)==null?void 0:D.receipt},null,8,["message"])])]),l("div",Ae,[l("div",Le,[s(e.InputLabel,{for:"amount",value:"Amount"}),s(e.TextInput,{id:"amount",modelValue:e.formData.amount,"onUpdate:modelValue":a[3]||(a[3]=m=>e.formData.amount=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"amount"},null,8,["modelValue"]),s(e.InputError,{class:"mt-2",message:(g=(h=e.formData)==null?void 0:h.errors)==null?void 0:g.amount},null,8,["message"])]),l("div",je,[s(e.InputLabel,{for:"reference_number",value:"Reference Number"}),s(e.TextInput,{id:"reference_number",modelValue:e.formData.reference_number,"onUpdate:modelValue":a[4]||(a[4]=m=>e.formData.reference_number=m),type:"text",class:"mt-1 block w-full",required:"",autofocus:"",autocomplete:"reference_number"},null,8,["modelValue"]),s(e.InputError,{class:"mt-2",message:(x=(v=e.formData)==null?void 0:v.errors)==null?void 0:x.reference_number},null,8,["message"])])])])]}),footer:n(()=>[l("div",Ce,[s(e.SecondaryButton,{onClick:e.cancelPayment},{default:n(()=>[...a[13]||(a[13]=[S(" Cancel ",-1)])]),_:1}),l("form",{onSubmit:Q(e.submit,["prevent"])},[s(e.LoadingButton,{loading:e.form.processing,class:"bg-primary ml-auto",type:"submit"},{default:n(()=>[...a[14]||(a[14]=[S(" Submit ",-1)])]),_:1},8,["loading"])],32)])]),default:n(()=>[a[15]||(a[15]=l("div",null,null,-1))]),_:1},8,["show"])]}),_:1})}const st=ce(de,[["render",Me],["__file","StallRental.vue"]]);export{st as default};
